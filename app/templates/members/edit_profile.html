{% extends "base.html" %}

{% block content %}
<div class="container py-5">
    <h1 class="fw-bold text-primary mb-4">Editar Perfil</h1>
    
    <form method="POST" enctype="multipart/form-data">
        <div class="mb-3">
            <label for="name" class="form-label">Nome</label>
            <input type="text" class="form-control" id="name" name="name" value="{{ current_user.name }}" required>
        </div>
        <div class="mb-3">
            <label for="birth_date" class="form-label">Data de Nascimento</label>
            <input type="date" class="form-control" id="birth_date" name="birth_date" value="{{ current_user.birth_date.strftime('%Y-%m-%d') if current_user.birth_date else '' }}">
        </div>
        <div class="mb-3">
            <label for="baptism_date" class="form-label">Data de Batismo</label>
            <input type="date" class="form-control" id="baptism_date" name="baptism_date" value="{{ current_user.baptism_date.strftime('%Y-%m-%d') if current_user.baptism_date else '' }}">
        </div>
        <div class="mb-3">
            <label for="conversion_date" class="form-label">Data de Conversão</label>
            <input type="date" class="form-control" id="conversion_date" name="conversion_date" value="{{ current_user.conversion_date.strftime('%Y-%m-%d') if current_user.conversion_date else '' }}">
        </div>
        <div class="mb-3">
            <label for="gender" class="form-label">Gênero</label>
            <select class="form-select" id="gender" name="gender">
                <option value="">Selecionar</option>
                <option value="Masculino" {{ 'selected' if current_user.gender == 'Masculino' }}>Masculino</option>
                <option value="Feminino" {{ 'selected' if current_user.gender == 'Feminino' }}>Feminino</option>
                <option value="Outro" {{ 'selected' if current_user.gender == 'Outro' }}>Outro</option>
            </select>
        </div>
        <div class="mb-3">
            <label for="marital_status" class="form-label">Estado Civil</label>
            <select class="form-select" id="marital_status" name="marital_status" onchange="toggleSpouseField()">
                <option value="">Selecionar</option>
                <option value="Solteiro(a)" {{ 'selected' if current_user.marital_status == 'Solteiro(a)' }}>Solteiro(a)</option>
                <option value="Casado(a)" {{ 'selected' if current_user.marital_status == 'Casado(a)' }}>Casado(a)</option>
                <option value="Divorciado(a)" {{ 'selected' if current_user.marital_status == 'Divorciado(a)' }}>Divorciado(a)</option>
                <option value="Viúvo(a)" {{ 'selected' if current_user.marital_status == 'Viúvo(a)' }}>Viúvo(a)</option>
            </select>
        </div>
        <div class="mb-3 {{ 'd-none' if current_user.marital_status != 'Casado(a)' }}" id="spouse_field">
            <label for="spouse_name" class="form-label">Nome do Cônjuge</label>
            <input type="text" class="form-control" id="spouse_name" name="spouse_name" value="{{ current_user.spouse_name or '' }}">
        </div>
        <div class="mb-3">
            <label for="documents" class="form-label">Documentos</label>
            <input type="text" class="form-control" id="documents" name="documents" value="{{ current_user.documents }}">
        </div>
        <div class="mb-3">
            <label for="address" class="form-label">Endereço</label>
            <textarea class="form-control" id="address" name="address" rows="3">{{ current_user.address or '' }}</textarea>
        </div>

        <!-- Novos campos -->
        <div class="mb-3">
            <label for="postal_code" class="form-label">Código Postal</label>
            <input type="text" class="form-control" id="postal_code" name="postal_code" 
                   value="{{ current_user.postal_code or '' }}" placeholder="Ex: 1250-123">
        </div>
        <div class="mb-3">
            <label for="concelho" class="form-label">Concelho / Município</label>
            <input type="text" class="form-control" id="concelho" name="concelho" 
                   value="{{ current_user.concelho or '' }}" placeholder="Ex: Lisboa">
        </div>
        <div class="mb-3">
            <label for="localidade" class="form-label">Localidade / Bairro</label>
            <input type="text" class="form-control" id="localidade" name="localidade" 
                   value="{{ current_user.localidade or '' }}" placeholder="Ex: São Domingos de Benfica">
        </div>
        <div class="mb-3">
            <label for="education_level" class="form-label">Escolaridade</label>
            <input type="text" class="form-control" id="education_level" name="education_level" 
                   value="{{ current_user.education_level or '' }}" placeholder="Ex: Ensino Superior Completo">
        </div>

        <div class="mb-3">
            <label for="phone" class="form-label">Telefone</label>
            <input type="tel" class="form-control" id="phone" name="phone" value="{{ current_user.phone or '' }}">
        </div>
        <div class="mb-3">
            <label for="profile_photo" class="form-label">Foto de Perfil (atual: {{ current_user.profile_photo if current_user.profile_photo else 'Nenhuma' }})</label>
            <input type="file" class="form-control" id="profile_photo" name="profile_photo" accept="image/*">
        </div>
        <button type="submit" class="btn btn-primary">Salvar Alterações</button>
        <a href="{{ url_for('members.profile') }}" class="btn btn-secondary">Cancelar</a>
    </form>
</div>

<script>
function toggleSpouseField() {
    const status = document.getElementById('marital_status').value;
    const spouseField = document.getElementById('spouse_field');
    const spouseInput = document.getElementById('spouse_name');
    
    if (status === 'Casado(a)') {
        spouseField.classList.remove('d-none');
        spouseInput.setAttribute('required', 'required');
    } else {
        spouseField.classList.add('d-none');
        spouseInput.removeAttribute('required');
        spouseInput.value = '';
    }
}
</script>
{% endblock %}