{% extends "base.html" %}

{% block content %}
<div class="container py-5 no-print">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold text-primary mb-0"><i class="bi bi-card-id me-2"></i>Cartão de Membro - {{ member.name }}</h2>
            <p class="text-muted">Visualize e imprima o cartão de identificação.</p>
        </div>
        <div class="d-flex gap-2">
            <button onclick="window.print()" class="btn btn-primary">
                <i class="bi bi-printer me-2"></i> Imprimir Cartão
            </button>
            <a href="{{ url_for('admin.list_members') }}" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left me-1"></i> Voltar
            </a>
        </div>
    </div>
</div>

<div class="card-print-container">
    <!-- FRENTE -->
    <div class="member-card front" style="background-image: url('{{ url_for('static', filename=member.church.member_card_front) if member.church and member.church.member_card_front else '' }}');">
        {% set front = member.church.card_front_layout or {} if member.church else {} %}

        <!-- Foto (se configurada) -->
        {% if front.photo %}
        <div class="member-photo-container" style="position: absolute; left: {{ front.photo.x }}px; top: {{ front.photo.y }}px; width: {{ front.photo.width }}px; height: {{ front.photo.height }}px; overflow: hidden; border-radius: 4px;">
            {% if member.profile_photo %}
            <img src="{{ url_for('static', filename=member.profile_photo) }}" alt="Foto do membro" style="width: 100%; height: 100%; object-fit: cover;">
            {% else %}
            <div class="placeholder-photo">Sem foto</div>
            {% endif %}
        </div>
        {% endif %}

        <!-- Nome -->
        {% if front.name %}
        <div class="field-value name" style="position: absolute; left: {{ front.name.x }}px; top: {{ front.name.y }}px; width: {{ front.name.width }}px;">
            {{ member.name }}
        </div>
        {% endif %}

        <!-- Cargo / Posição -->
        {% if front.role %}
        <div class="field-value role" style="position: absolute; left: {{ front.role.x }}px; top: {{ front.role.y }}px; width: {{ front.role.width }}px;">
            {{ member.church_role.name if member.church_role else 'Membro' }}
        </div>
        {% endif %}

        <!-- Estado Civil -->
        {% if front.marital_status %}
        <div class="field-value" style="position: absolute; left: {{ front.marital_status.x }}px; top: {{ front.marital_status.y }}px; width: {{ front.marital_status.width }}px;">
            {{ member.marital_status or 'Não informado' }}
        </div>
        {% endif %}

        <!-- Data de Nascimento -->
        {% if front.birth_date %}
        <div class="field-value" style="position: absolute; left: {{ front.birth_date.x }}px; top: {{ front.birth_date.y }}px; width: {{ front.birth_date.width }}px;">
            {{ member.birth_date.strftime('%d/%m/%Y') if member.birth_date else 'Não informado' }}
        </div>
        {% endif %}
    </div>

    <!-- VERSO -->
    <div class="member-card back" style="background-image: url('{{ url_for('static', filename=member.church.member_card_back) if member.church and member.church.member_card_back else '' }}'); margin-top: 40px;">
        {% set back = member.church.card_back_layout or {} if member.church else {} %}

        <!-- Filiação -->
        {% if back.filiacao %}
        <div class="field-value filiacao" style="position: absolute; left: {{ back.filiacao.x }}px; top: {{ back.filiacao.y }}px; width: {{ back.filiacao.width }}px;">
            {{ member.church.name if member.church else 'Não informado' }}
        </div>
        {% endif %}

        <!-- Documento -->
        {% if back.document %}
        <div class="field-value" style="position: absolute; left: {{ back.document.x }}px; top: {{ back.document.y }}px; width: {{ back.document.width }}px;">
            {{ member.tax_id or member.documents or 'Não informado' }}
        </div>
        {% endif %}

        <!-- Data de Conversão -->
        {% if back.conversion_date %}
        <div class="field-value" style="position: absolute; left: {{ back.conversion_date.x }}px; top: {{ back.conversion_date.y }}px; width: {{ back.conversion_date.width }}px;">
            {{ member.conversion_date.strftime('%d/%m/%Y') if member.conversion_date else 'Não informado' }}
        </div>
        {% endif %}

        <!-- Data de Batismo -->
        {% if back.baptism_date %}
        <div class="field-value" style="position: absolute; left: {{ back.baptism_date.x }}px; top: {{ back.baptism_date.y }}px; width: {{ back.baptism_date.width }}px;">
            {{ member.baptism_date.strftime('%d/%m/%Y') if member.baptism_date else 'Não informado' }}
        </div>
        {% endif %}

        <!-- Disclaimer -->
        {% if back.disclaimer %}
        <div class="field-value disclaimer" style="position: absolute; left: {{ back.disclaimer.x }}px; top: {{ back.disclaimer.y }}px; width: {{ back.disclaimer.width }}px; height: {{ back.disclaimer.height }}px;">
            Este documento tem validade enquanto o(a) titular permanecer em plena comunhão como membro da Assembleia de Deus IEAD Jesus para as Nações em Aveiro - Portugal.
        </div>
        {% endif %}

        <!-- Assinatura -->
        {% if back.signature %}
        <div class="field-value signature" style="position: absolute; left: {{ back.signature.x }}px; top: {{ back.signature.y }}px; width: {{ back.signature.width }}px;">
            Pr. Fernando Telles dos Santos<br>Presidente da IEAD Jesus Para as Nações
        </div>
        {% endif %}
    </div>
</div>

<style>
.card-print-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 60px;
    padding: 20px;
}

.member-card {
    width: 856px;
    height: 540px;
    background-size: cover;
    background-position: center;
    position: relative;
    overflow: hidden;
    border-radius: 8px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.2);
}

.field-value {
    position: absolute;
    color: black; /* ou ajuste conforme a arte */
    font-size: 16px;
    font-weight: 500;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.name { font-size: 20px; font-weight: bold; }
.role { font-size: 18px; }
.disclaimer { font-size: 13px; line-height: 1.4; text-align: center; }
.signature { font-size: 14px; text-align: center; color: #333; }

@media print {
    .no-print { display: none !important; }
    .card-print-container { gap: 40px; padding: 0; }
    .member-card { box-shadow: none; page-break-after: always; }
    body { background: white; margin: 0; }
}
</style>
{% endblock %}