{% extends "base.html" %}
{% block content %}
<div class="container py-5 text-center">
    <div class="mb-4">
        <a href="{{ url_for('edification.kids') }}" class="btn btn-outline-warning rounded-pill mb-3">
            <i class="bi bi-arrow-left me-2"></i> Voltar para Ecclesia Kids
        </a>
        <h1 class="fw-bold text-warning">Jogo da Mem√≥ria B√≠blico</h1>
        <p class="text-muted">Encontre os pares dos personagens da B√≠blia!</p>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
            <div id="game-board" class="memory-grid">
                <!-- Cards will be generated by JavaScript -->
            </div>
            
            <div class="mt-5 p-4 bg-light rounded-4 shadow-sm">
                <div class="row align-items-center">
                    <div class="col">
                        <h4 class="mb-0 fw-bold">Tentativas: <span id="moves">0</span></h4>
                    </div>
                    <div class="col">
                        <button onclick="resetGame()" class="btn btn-warning btn-lg fw-bold px-4 rounded-pill">
                            <i class="bi bi-arrow-clockwise me-2"></i> Reiniciar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.memory-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 15px;
    perspective: 1000px;
}

.memory-card {
    aspect-ratio: 1/1;
    position: relative;
    transform-style: preserve-3d;
    transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
}

.memory-card.flipped {
    transform: rotateY(180deg);
}

.card-front, .card-back {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 15px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    font-size: 2.5rem;
}

.card-back {
    background: linear-gradient(135deg, #ffc107, #ffdb6e);
    color: white;
}

.card-front {
    background: white;
    transform: rotateY(180deg);
}

.memory-card.matched .card-front {
    background-color: #e8f5e9;
    border: 3px solid #4caf50;
}

@media (max-width: 576px) {
    .memory-grid {
        grid-template-columns: repeat(3, 1fr);
    }
}
</style>

<script>
const characters = [
    { name: 'Arca', icon: 'üö¢' },
    { name: 'Davi', icon: 'üëë' },
    { name: 'Golias', icon: '‚öîÔ∏è' },
    { name: 'Mois√©s', icon: 'üìú' },
    { name: 'Le√£o', icon: 'ü¶Å' },
    { name: 'Peixe', icon: 'üêü' },
    { name: 'Pomba', icon: 'üïäÔ∏è' },
    { name: 'Estrela', icon: '‚≠ê' }
];

let cards = [];
let flippedCards = [];
let matchedPairs = 0;
let moves = 0;
let canFlip = true;

function initGame() {
    const gameBoard = document.getElementById('game-board');
    gameBoard.innerHTML = '';
    
    // Create pairs and shuffle
    const deck = [...characters, ...characters]
        .sort(() => Math.random() - 0.5);
    
    deck.forEach((char, index) => {
        const card = document.createElement('div');
        card.className = 'memory-card';
        card.dataset.name = char.name;
        card.innerHTML = `
            <div class="card-back"><i class="bi bi-question-lg"></i></div>
            <div class="card-front">${char.icon}</div>
        `;
        card.onclick = () => flipCard(card);
        gameBoard.appendChild(card);
    });
}

function flipCard(card) {
    if (!canFlip || card.classList.contains('flipped') || card.classList.contains('matched')) return;
    
    card.classList.add('flipped');
    flippedCards.push(card);
    
    if (flippedCards.length === 2) {
        moves++;
        document.getElementById('moves').innerText = moves;
        checkMatch();
    }
}

function checkMatch() {
    canFlip = false;
    const [card1, card2] = flippedCards;
    
    if (card1.dataset.name === card2.dataset.name) {
        card1.classList.add('matched');
        card2.classList.add('matched');
        matchedPairs++;
        flippedCards = [];
        canFlip = true;
        
        if (matchedPairs === characters.length) {
            setTimeout(() => alert(`Parab√©ns! Voc√™ completou em ${moves} tentativas!`), 500);
        }
    } else {
        setTimeout(() => {
            card1.classList.remove('flipped');
            card2.classList.remove('flipped');
            flippedCards = [];
            canFlip = true;
        }, 1000);
    }
}

function resetGame() {
    moves = 0;
    matchedPairs = 0;
    document.getElementById('moves').innerText = '0';
    initGame();
}

document.addEventListener('DOMContentLoaded', initGame);
</script>
{% endblock %}