\n\n===== ./app/core/models.py =====
from datetime import datetime
from flask_sqlalchemy import SQLAlchemy
from flask_login import UserMixin
from werkzeug.security import generate_password_hash, check_password_hash

db = SQLAlchemy()

# Tabela de associação para Membros e Ministérios (Muitos-para-Muitos)
member_ministries = db.Table('member_ministries',
    db.Column('user_id', db.Integer, db.ForeignKey('user.id'), primary_key=True),
    db.Column('ministry_id', db.Integer, db.ForeignKey('ministry.id'), primary_key=True)
)

class Church(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    name = db.Column(db.String(100), nullable=False)
    address = db.Column(db.String(200))
    city = db.Column(db.String(100))
    country = db.Column(db.String(100))
    is_main = db.Column(db.Boolean, default=False)
    created_at = db.Column(db.DateTime, default=datetime.utcnow)
    
    members = db.relationship('User', backref='church', lazy=True)
    ministries = db.relationship('Ministry', backref='church', lazy=True)
    assets = db.relationship('Asset', backref='church', lazy=True)
    roles = db.relationship('ChurchRole', backref='church', lazy=True, cascade="all, delete-orphan")

class ChurchRole(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    name = db.Column(db.String(80), nullable=False)
    description = db.Column(db.Text, nullable=True)
    church_id = db.Column(db.Integer, db.ForeignKey('church.id'), nullable=False)
    is_active = db.Column(db.Boolean, default=True)
    order = db.Column(db.Integer, default=0)  # para ordenar na exibição
    
    users = db.relationship('User', backref='church_role', lazy=True)

class User(db.Model, UserMixin):
    id = db.Column(db.Integer, primary_key=True)
    name = db.Column(db.String(100), nullable=False)
    email = db.Column(db.String(120), unique=True, nullable=False)
    password_hash = db.Column(db.String(128))
    
    # Dados Pessoais Expandidos
    birth_date = db.Column(db.Date)
    gender = db.Column(db.String(20))
    documents = db.Column(db.String(200)) # Flexível para diferentes países
    address = db.Column(db.Text)
    phone = db.Column(db.String(50))
    
    # Status e Permissões
    status = db.Column(db.String(20), default='pending') # pending, active, rejected
    is_ministry_leader = db.Column(db.Boolean, default=False)
    
    church_id = db.Column(db.Integer, db.ForeignKey('church.id'))
    family_id = db.Column(db.Integer, db.ForeignKey('family.id'), nullable=True)
    church_role_id = db.Column(db.Integer, db.ForeignKey('church_role.id'), nullable=True)
    
    # Relacionamentos
    ministries = db.relationship('Ministry', secondary=member_ministries, backref=db.backref('members', lazy='dynamic'))
    
    def set_password(self, password):
        self.password_hash = generate_password_hash(password)
    
    def check_password(self, password):
        return check_password_hash(self.password_hash, password)
    
    # Permissoes
    can_manage_ministries = db.Column(db.Boolean, default=False)
    can_manage_media = db.Column(db.Boolean, default=False)
    can_publish_devotionals = db.Column(db.Boolean, default=False)
    can_approve_members = db.Column(db.Boolean, default=False)
    can_manage_finance = db.Column(db.Boolean, default=False)
    can_manage_kids = db.Column(db.Boolean, default=False)
    can_manage_events = db.Column(db.Boolean, default=False)  # para eventos gerais

class Ministry(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    name = db.Column(db.String(100), nullable=False)
    description = db.Column(db.Text)
    church_id = db.Column(db.Integer, db.ForeignKey('church.id'))
    leader_id = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=True)
    
    events = db.relationship('Event', backref='ministry', lazy=True)
    leader = db.relationship('User', foreign_keys=[leader_id])

class Event(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    title = db.Column(db.String(100), nullable=False)
    description = db.Column(db.Text)
    start_time = db.Column(db.DateTime, nullable=False)
    location = db.Column(db.String(200))
    ministry_id = db.Column(db.Integer, db.ForeignKey('ministry.id'), nullable=True) # Se nulo, é evento geral da igreja
    church_id = db.Column(db.Integer, db.ForeignKey('church.id'))
    recurrence = db.Column(db.String(20), default='none')  # 'none', 'weekly', 'monthly', 'quarterly'

class Asset(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    name = db.Column(db.String(100), nullable=False)
    category = db.Column(db.String(50)) # Equipamento, Veículo, Móvel
    identifier = db.Column(db.String(50)) # Placa, Serial
    purchase_date = db.Column(db.Date)
    value = db.Column(db.Float)
    church_id = db.Column(db.Integer, db.ForeignKey('church.id'))
    
    maintenance_logs = db.relationship('MaintenanceLog', backref='asset', lazy=True)

class MaintenanceLog(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    asset_id = db.Column(db.Integer, db.ForeignKey('asset.id'))
    date = db.Column(db.Date, default=datetime.utcnow().date)
    description = db.Column(db.Text)
    cost = db.Column(db.Float, default=0.0)
    type = db.Column(db.String(50)) # Combustível, Seguro, Reparo

class Family(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    name = db.Column(db.String(100), nullable=False)
    users = db.relationship('User', backref='family_group', lazy=True)

class Transaction(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    type = db.Column(db.String(10)) # income, expense
    category = db.Column(db.String(50))
    amount = db.Column(db.Float, nullable=False)
    date = db.Column(db.DateTime, default=datetime.utcnow)
    description = db.Column(db.Text)
    user_id = db.Column(db.Integer, db.ForeignKey('user.id'), nullable=True)
    church_id = db.Column(db.Integer, db.ForeignKey('church.id'))
    receipt_path = db.Column(db.String(255))
    
    church = db.relationship('Church', backref='transactions')
    user = db.relationship('User', backref='transactions')

class KidsActivity(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    title = db.Column(db.String(100), nullable=False)
    content = db.Column(db.Text) # Markdown ou link para imagem/PDF
    age_group = db.Column(db.String(20))
    created_at = db.Column(db.DateTime, default=datetime.utcnow)

class Study(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    title = db.Column(db.String(200), nullable=False)
    content = db.Column(db.Text, nullable=False)
    category = db.Column(db.String(50), default='Geral')
    author_id = db.Column(db.Integer, db.ForeignKey('user.id'))
    created_at = db.Column(db.DateTime, default=datetime.utcnow)
    
    questions = db.relationship('StudyQuestion', backref='study', lazy=True)

class StudyQuestion(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    study_id = db.Column(db.Integer, db.ForeignKey('study.id'))
    question_text = db.Column(db.Text, nullable=False)
    options = db.Column(db.Text) # JSON string com opções
    correct_option = db.Column(db.Integer)

class Devotional(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    title = db.Column(db.String(200))
    content = db.Column(db.Text, nullable=False)
    verse = db.Column(db.String(200))
    date = db.Column(db.Date, default=datetime.utcnow().date)

class Media(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    title = db.Column(db.String(200), nullable=False)
    description = db.Column(db.Text)
    file_path = db.Column(db.String(255), nullable=False)
    media_type = db.Column(db.String(20), default='image')  # 'image', 'pdf', 'video', etc.
    event_name = db.Column(db.String(200))
    created_at = db.Column(db.DateTime, default=datetime.utcnow)
    church_id = db.Column(db.Integer, db.ForeignKey('church.id'), nullable=False)
    ministry_id = db.Column(db.Integer, db.ForeignKey('ministry.id'), nullable=True)  # ← Novo campo!
    
    church = db.relationship('Church', backref='media_items')
    ministry = db.relationship('Ministry', backref='media_items')  # ← Relacionamento inverso
\n\n===== ./app/modules/auth/routes.py =====
from flask import Blueprint, render_template, redirect, url_for, flash, request
from flask_login import login_user, logout_user, login_required, current_user
from app.core.models import User, Church, db
from datetime import datetime

auth_bp = Blueprint('auth', __name__)

@auth_bp.route('/login', methods=['GET', 'POST'])
def login():
    if current_user.is_authenticated:
        return redirect(url_for('members.dashboard'))
    if request.method == 'POST':
        email = request.form.get('email')
        password = request.form.get('password')
        user = User.query.filter_by(email=email).first()
        if user and user.check_password(password):
            if user.status == 'pending':
                flash('Seu cadastro ainda está em análise pela liderança.', 'warning')
                return redirect(url_for('auth.login'))
            if user.status == 'rejected':
                flash('Seu cadastro não foi aprovado. Entre em contato com a secretaria.', 'danger')
                return redirect(url_for('auth.login'))
            login_user(user, remember=True)
            return redirect(url_for('members.dashboard'))
        flash('E-mail ou senha incorretos.', 'danger')
    return render_template('auth/login.html')

@auth_bp.route('/register', methods=['GET', 'POST'])
def register():
    if request.method == 'POST':
        email = request.form.get('email')
        if User.query.filter_by(email=email).first():
            flash('E-mail já cadastrado.', 'danger')
            return redirect(url_for('auth.register'))
            
        new_user = User(
            name=request.form.get('name'),
            email=email,
            birth_date=datetime.strptime(request.form.get('birth_date'), '%Y-%m-%d').date(),
            gender=request.form.get('gender'),
            documents=request.form.get('documents'),
            address=request.form.get('address'),
            phone=request.form.get('phone'),
            church_id=request.form.get('church_id'),
            status='pending'
        )
        new_user.set_password(request.form.get('password'))
        db.session.add(new_user)
        db.session.commit()
        flash('Solicitação enviada com sucesso! Aguarde a aprovação da liderança.', 'success')
        return redirect(url_for('auth.login'))
        
    churches = Church.query.all()
    return render_template('auth/register.html', churches=churches)

@auth_bp.route('/logout')
@login_required
def logout():
    logout_user()
    return redirect(url_for('auth.login'))

@auth_bp.route('/change-password', methods=['GET', 'POST'])
@login_required
def change_password():
    if request.method == 'POST':
        old_password = request.form.get('old_password')
        new_password = request.form.get('new_password')
        confirm_password = request.form.get('confirm_password')
        
        if not current_user.check_password(old_password):
            flash('Senha atual incorreta.', 'danger')
        elif new_password != confirm_password:
            flash('As novas senhas não coincidem.', 'danger')
        else:
            current_user.set_password(new_password)
            db.session.commit()
            flash('Senha alterada com sucesso!', 'success')
            return redirect(url_for('members.profile'))
            
    return render_template('auth/change_password.html')

# Rota de Aprovação (Acessível por Admin e Pastor Líder)
@auth_bp.route('/admin/approve/<int:user_id>/<string:action>')
@login_required
def approve_member(user_id, action):
    # Verifica se o usuário tem permissão (usando o novo campo church_role)
    if not current_user.church_role or current_user.church_role.name not in ['Administrador Global', 'Pastor Líder']:
        flash('Acesso negado.', 'danger')
        return redirect(url_for('members.dashboard'))
        
    user = User.query.get_or_404(user_id)
    
    # Garante que o aprovador só aprove/rejeite membros da própria filial (exceto admin global)
    if current_user.church_role.name != 'Administrador Global' and user.church_id != current_user.church_id:
        flash('Você não tem permissão para aprovar membros de outras congregações.', 'danger')
        return redirect(url_for('members.dashboard'))
    
    if action == 'approve':
        user.status = 'active'
        flash(f'Membro {user.name} aprovado com sucesso!', 'success')
    elif action == 'reject':
        user.status = 'rejected'
        flash(f'Membro {user.name} rejeitado.', 'warning')
    else:
        flash('Ação inválida.', 'danger')
        return redirect(url_for('members.dashboard'))
    
    db.session.commit()
    return redirect(request.referrer or url_for('members.dashboard'))
\n\n===== ./app/modules/members/routes.py =====
from flask import Blueprint, render_template, redirect, url_for, flash, request
from flask_login import login_required, current_user
from app.core.models import User, Church, Ministry, Event, db, Devotional, Study, ChurchRole
from datetime import datetime
from sqlalchemy import func

members_bp = Blueprint('members', __name__)

def can_manage_members():
    return current_user.can_approve_members or (current_user.church_role and current_user.church_role.name in ['Administrador Global', 'Pastor Líder'])

def can_manage_ministries():
    return current_user.can_manage_ministries or (current_user.church_role and current_user.church_role.name in ['Administrador Global', 'Pastor Líder'])

@members_bp.route('/dashboard')
@login_required
def dashboard():
    latest_devotional = Devotional.query.order_by(Devotional.date.desc()).first()
    recent_studies = Study.query.order_by(Study.created_at.desc()).limit(3).all()
    
    ministry_ids = [m.id for m in current_user.ministries]
    personal_agenda = Event.query.filter(
        (Event.church_id == current_user.church_id) & 
        ((Event.ministry_id == None) | (Event.ministry_id.in_(ministry_ids)))
    ).order_by(Event.start_time.asc()).all()
    
    pending_members = []
    if can_manage_members():
        pending_members = User.query.filter_by(church_id=current_user.church_id, status='pending').all()
        
    return render_template('members/dashboard.html', 
                           devotional=latest_devotional, 
                           studies=recent_studies,
                           agenda=personal_agenda,
                           pending_members=pending_members,
                           datetime=datetime)

@members_bp.route('/profile')
@login_required
def profile():
    return render_template('members/profile.html')

@members_bp.route('/ministries')
@login_required
def list_ministries():
    if current_user.church_role and current_user.church_role.name == 'Administrador Global':
        ministries = Ministry.query.all()
    elif can_manage_ministries():
        ministries = Ministry.query.filter_by(church_id=current_user.church_id).all()
    else:
        ministries = current_user.ministries
    
    return render_template('members/ministries.html', ministries=ministries)

@members_bp.route('/ministry/add', methods=['GET', 'POST'])
@login_required
def add_ministry():
    if not can_manage_ministries():
        flash('Acesso negado.', 'danger')
        return redirect(url_for('members.list_ministries'))
        
    if request.method == 'POST':
        leader_id = request.form.get('leader_id')
        new_min = Ministry(
            name=request.form.get('name'),
            description=request.form.get('description'),
            church_id=current_user.church_id,
            leader_id=int(leader_id) if leader_id else None
        )
        db.session.add(new_min)
        db.session.commit()
        
        if leader_id:
            leader = User.query.get(int(leader_id))
            new_min.members.append(leader)
            db.session.commit()
        
        flash('Ministério criado com sucesso!', 'success')
        return redirect(url_for('members.list_ministries'))
        
    potential_leaders = User.query.filter_by(church_id=current_user.church_id, status='active').all()
    return render_template('members/add_ministry.html', leaders=potential_leaders)

@members_bp.route('/ministry/<int:id>/edit', methods=['GET', 'POST'])
@login_required
def edit_ministry(id):
    ministry = Ministry.query.get_or_404(id)
    
    if not can_manage_ministries():
        flash('Acesso negado.', 'danger')
        return redirect(url_for('members.list_ministries'))
        
    if request.method == 'POST':
        ministry.name = request.form.get('name')
        ministry.description = request.form.get('description')
        ministry.leader_id = request.form.get('leader_id')
        
        if current_user.church_role and current_user.church_role.name == 'Administrador Global':
            church_id = request.form.get('church_id')
            if church_id:
                ministry.church_id = int(church_id)
        
        db.session.commit()
        
        if ministry.leader_id:
            leader = User.query.get(ministry.leader_id)
            if leader and leader not in ministry.members:
                ministry.members.append(leader)
                db.session.commit()
        
        flash('Ministério atualizado!', 'success')
        return redirect(url_for('members.list_ministries'))
    
    churches = Church.query.all() if current_user.church_role and current_user.church_role.name == 'Administrador Global' else None
    potential_leaders = User.query.filter_by(church_id=ministry.church_id, status='active').all()
    return render_template('members/edit_ministry.html', 
                           ministry=ministry, 
                           leaders=potential_leaders, 
                           churches=churches)

@members_bp.route('/ministry/<int:id>/delete')
@login_required
def delete_ministry(id):
    ministry = Ministry.query.get_or_404(id)
    
    if not can_manage_ministries():
        flash('Acesso negado.', 'danger')
        return redirect(url_for('members.list_ministries'))
        
    db.session.delete(ministry)
    db.session.commit()
    flash('Ministério excluído com sucesso!', 'success')
    return redirect(url_for('members.list_ministries'))

@members_bp.route('/ministry/<int:id>/event/add', methods=['GET', 'POST'])
@login_required
def add_ministry_event(id):
    ministry = Ministry.query.get_or_404(id)
    
    is_leader = ministry.leader_id == current_user.id
    is_authorized = is_leader or current_user.can_manage_events or (current_user.church_role and current_user.church_role.name in ['Administrador Global', 'Pastor Líder'])
    
    if not is_authorized:
        flash('Acesso negado.', 'danger')
        return redirect(url_for('members.list_ministries'))
        
    if request.method == 'POST':
        new_event = Event(
            title=request.form.get('title'),
            description=request.form.get('description'),
            start_time=datetime.strptime(request.form.get('start_time'), '%Y-%m-%dT%H:%M'),
            location=request.form.get('location'),
            ministry_id=ministry.id,
            church_id=current_user.church_id
        )
        db.session.add(new_event)
        db.session.commit()
        flash('Evento do ministério agendado!', 'success')
        return redirect(url_for('members.dashboard'))
        
    return render_template('members/add_event.html', ministry=ministry)

@members_bp.route('/my-church/members')
@login_required
def church_members():
    if not can_manage_members():
        flash('Acesso negado.', 'danger')
        return redirect(url_for('members.dashboard'))
    
    members = User.query.filter_by(church_id=current_user.church_id).all()
    return render_template('members/church_members.html', members=members)

@members_bp.route('/member/promote/<int:id>', methods=['GET', 'POST'])
@login_required
def promote_member(id):
    if not can_manage_members():
        flash('Acesso negado.', 'danger')
        return redirect(url_for('members.dashboard'))
    
    member = User.query.get_or_404(id)
    if member.church_id != current_user.church_id and not (current_user.church_role and current_user.church_role.name == 'Administrador Global'):
        flash('Este membro não pertence à sua congregação.', 'danger')
        return redirect(url_for('members.church_members'))
    
    if request.method == 'POST':
        new_role_id = request.form.get('church_role_id')
        member.church_role_id = int(new_role_id) if new_role_id else None
        
        member.can_manage_ministries = 'can_manage_ministries' in request.form
        member.can_manage_media = 'can_manage_media' in request.form
        member.can_publish_devotionals = 'can_publish_devotionals' in request.form
        member.can_manage_finance = 'can_manage_finance' in request.form
        member.can_manage_events = 'can_manage_events' in request.form
        
        db.session.commit()
        flash(f'Cargo e permissões de {member.name} atualizados!', 'success')
        return redirect(url_for('members.church_members'))
    
    roles = ChurchRole.query.filter_by(church_id=member.church_id).order_by(ChurchRole.order, ChurchRole.name).all()
    return render_template('members/promote_member.html', member=member, roles=roles)

@members_bp.route('/ministries/led-by-me')
@login_required
def my_led_ministries():
    led_ministries = Ministry.query.filter_by(leader_id=current_user.id).all()
    return render_template('members/my_led_ministries.html', led_ministries=led_ministries)

@members_bp.route('/ministry/<int:ministry_id>/manage-members')
@login_required
def ministry_manage_members(ministry_id):
    ministry = Ministry.query.get_or_404(ministry_id)
    
    is_leader = ministry.leader_id == current_user.id
    is_authorized = is_leader or can_manage_ministries()
    
    if not is_authorized:
        flash('Acesso negado.', 'danger')
        return redirect(url_for('members.my_led_ministries'))
    
    current_members = ministry.members.all()
    available_members = User.query.filter(
        User.church_id == current_user.church_id,
        User.status == 'active',
        ~User.ministries.any(Ministry.id == ministry_id)
    ).order_by(User.name).all()
    
    total_members = len(current_members)
    gender_count = db.session.query(User.gender, func.count(User.id)).filter(
        User.id.in_([m.id for m in current_members])
    ).group_by(User.gender).all()
    
    return render_template('members/ministry_manage_members.html',
                           ministry=ministry,
                           current_members=current_members,
                           available_members=available_members,
                           total_members=total_members,
                           gender_count=gender_count)

@members_bp.route('/ministry/<int:ministry_id>/add-member', methods=['POST'])
@login_required
def ministry_add_member(ministry_id):
    ministry = Ministry.query.get_or_404(ministry_id)
    
    is_leader = ministry.leader_id == current_user.id
    is_authorized = is_leader or can_manage_ministries()
    
    if not is_authorized:
        flash('Acesso negado.', 'danger')
        return redirect(url_for('members.ministry_manage_members', ministry_id=ministry_id))
    
    user_id = request.form.get('user_id')
    if not user_id:
        flash('Selecione um membro.', 'warning')
        return redirect(url_for('members.ministry_manage_members', ministry_id=ministry_id))
    
    member = User.query.get_or_404(int(user_id))
    if member.church_id != ministry.church_id:
        flash('Membro não pertence a esta congregação.', 'danger')
    elif member not in ministry.members:
        ministry.members.append(member)
        db.session.commit()
        flash(f'{member.name} adicionado ao ministério!', 'success')
    
    return redirect(url_for('members.ministry_manage_members', ministry_id=ministry_id))

@members_bp.route('/ministry/<int:ministry_id>/remove-member/<int:user_id>')
@login_required
def ministry_remove_member(ministry_id, user_id):
    ministry = Ministry.query.get_or_404(ministry_id)
    
    is_leader = ministry.leader_id == current_user.id
    is_authorized = is_leader or can_manage_ministries()
    
    if not is_authorized:
        flash('Acesso negado.', 'danger')
        return redirect(url_for('members.ministry_manage_members', ministry_id=ministry_id))
    
    member = User.query.get_or_404(user_id)
    if member in ministry.members:
        ministry.members.remove(member)
        db.session.commit()
        flash(f'{member.name} removido do ministério.', 'info')
    
    return redirect(url_for('members.ministry_manage_members', ministry_id=ministry_id))

\n\n===== ./app/modules/finance/routes.py =====
from flask import Blueprint, render_template, redirect, url_for, flash, request, send_from_directory, current_app
from flask_login import login_required, current_user
from app.core.models import Transaction, Asset, MaintenanceLog, db, User, Church
from app.utils.pdf_gen import generate_receipt
import os
from datetime import datetime, timedelta
from sqlalchemy import func

finance_bp = Blueprint('finance', __name__)

def is_admin():
    return current_user.church_role and current_user.church_role.name == 'Administrador Global'

def can_manage_finance():
    return current_user.can_manage_finance or (current_user.church_role and current_user.church_role.name in ['Administrador Global', 'Pastor Líder', 'Tesoureiro'])

@finance_bp.route('/dashboard')
@login_required
def dashboard():
    # Verifica permissões
    if not can_manage_finance():
        # Membros comuns veem apenas suas próprias transações
        transactions = Transaction.query.filter_by(user_id=current_user.id).order_by(Transaction.date.desc()).all()
        return render_template('finance/dashboard.html', transactions=transactions, assets=[], stats=None)

    # Filtro por igreja
    if is_admin():
        query = Transaction.query
        asset_query = Asset.query
    else:
        query = Transaction.query.filter_by(church_id=current_user.church_id)
        asset_query = Asset.query.filter_by(church_id=current_user.church_id)

    transactions = query.order_by(Transaction.date.desc()).all()
    assets = asset_query.all()

    # Estatísticas Simples
    total_income = sum(t.amount for t in transactions if t.type == 'income')
    total_expense = sum(t.amount for t in transactions if t.type == 'expense')
    balance = total_income - total_expense

    stats = {
        'income': total_income,
        'expense': total_expense,
        'balance': balance
    }

    return render_template('finance/dashboard.html', transactions=transactions, assets=assets, stats=stats)

@finance_bp.route('/asset/add', methods=['GET', 'POST'])
@login_required
def add_asset():
    if not can_manage_finance():
        flash('Acesso negado.', 'danger')
        return redirect(url_for('finance.dashboard'))
        
    if request.method == 'POST':
        new_asset = Asset(
            name=request.form.get('name'),
            category=request.form.get('category'),
            identifier=request.form.get('identifier'),
            value=float(request.form.get('value') or 0),
            purchase_date=datetime.strptime(request.form.get('purchase_date'), '%Y-%m-%d').date() if request.form.get('purchase_date') else None,
            church_id=current_user.church_id
        )
        db.session.add(new_asset)
        db.session.commit()
        flash('Bem cadastrado no patrimônio!', 'success')
        return redirect(url_for('finance.dashboard'))
    
    return render_template('finance/add_asset.html')

@finance_bp.route('/asset/<int:id>/maintenance', methods=['GET', 'POST'])
@login_required
def add_maintenance(id):
    asset = Asset.query.get_or_404(id)
    
    if not can_manage_finance():
        flash('Acesso negado.', 'danger')
        return redirect(url_for('finance.dashboard'))
        
    if request.method == 'POST':
        log = MaintenanceLog(
            asset_id=asset.id,
            description=request.form.get('description'),
            cost=float(request.form.get('cost') or 0),
            type=request.form.get('type'),
            date=datetime.strptime(request.form.get('date'), '%Y-%m-%d').date() if request.form.get('date') else datetime.utcnow().date()
        )
        # Registra também como despesa financeira
        tx = Transaction(
            type='expense',
            category=f'Manutenção: {asset.name}',
            amount=log.cost,
            description=log.description,
            church_id=current_user.church_id,
            date=datetime.combine(log.date, datetime.min.time())
        )
        db.session.add(log)
        db.session.add(tx)
        db.session.commit()
        flash('Manutenção registrada e lançada no financeiro!', 'success')
        return redirect(url_for('finance.dashboard'))
    
    return render_template('finance/add_maintenance.html', asset=asset)

@finance_bp.route('/add', methods=['GET', 'POST'])
@login_required
def add_transaction():
    if not can_manage_finance():
        flash('Acesso negado.', 'danger')
        return redirect(url_for('finance.dashboard'))
        
    if request.method == 'POST':
        user_id = request.form.get('user_id')
        new_tx = Transaction(
            type=request.form.get('type'),
            category=request.form.get('category'),
            amount=float(request.form.get('amount') or 0),
            description=request.form.get('description'),
            user_id=int(user_id) if user_id and user_id != '' else None,
            church_id=current_user.church_id,
            date=datetime.strptime(request.form.get('date'), '%Y-%m-%d') if request.form.get('date') else datetime.utcnow()
        )
        db.session.add(new_tx)
        db.session.commit()
        
        if new_tx.user_id:
            new_tx.receipt_path = generate_receipt(new_tx)
            db.session.commit()
            
        flash('Transação registrada com sucesso!', 'success')
        return redirect(url_for('finance.dashboard'))
        
    members = User.query.filter_by(church_id=current_user.church_id, status='active').all()
    today = datetime.utcnow().date().isoformat()
    return render_template('finance/add.html', members=members, today=today)

@finance_bp.route('/receipt/<int:tx_id>')
@login_required
def download_receipt(tx_id):
    tx = Transaction.query.get_or_404(tx_id)
    
    # Permissão: Admin, Tesoureiro ou o próprio dono do recibo
    if not can_manage_finance() and tx.user_id != current_user.id:
        flash('Acesso negado.', 'danger')
        return redirect(url_for('finance.dashboard'))
        
    if not tx.receipt_path:
        tx.receipt_path = generate_receipt(tx)
        db.session.commit()
        
    return send_from_directory(
        os.path.join(current_app.config['UPLOAD_FOLDER'], 'receipts'),
        tx.receipt_path,
        as_attachment=True
    )

@finance_bp.route('/report')
@login_required
def report():
    if not can_manage_finance():
        flash('Acesso negado.', 'danger')
        return redirect(url_for('finance.dashboard'))

    # Relatório simplificado por categoria (últimos 30 dias)
    thirty_days_ago = datetime.utcnow() - timedelta(days=30)
    
    if is_admin():
        results = db.session.query(
            Transaction.category, 
            Transaction.type, 
            func.sum(Transaction.amount)
        ).filter(Transaction.date >= thirty_days_ago).group_by(Transaction.category, Transaction.type).all()
    else:
        results = db.session.query(
            Transaction.category, 
            Transaction.type, 
            func.sum(Transaction.amount)
        ).filter(
            Transaction.church_id == current_user.church_id,
            Transaction.date >= thirty_days_ago
        ).group_by(Transaction.category, Transaction.type).all()

    return render_template('finance/report.html', results=results)

\n\n===== ./app/modules/edification/routes.py =====
from flask import Blueprint, render_template, redirect, url_for, flash, request, current_app
from flask_login import login_required, current_user
from app.core.models import Study, Devotional, KidsActivity, StudyQuestion, db, Media, Ministry
import markdown
import os
from werkzeug.utils import secure_filename

edification_bp = Blueprint('edification', __name__)

ALLOWED_EXTENSIONS = {'png', 'jpg', 'jpeg', 'gif', 'mp4', 'pdf'}

def allowed_file(filename):
    return '.' in filename and filename.rsplit('.', 1)[1].lower() in ALLOWED_EXTENSIONS

def can_manage_content():
    return current_user.can_publish_devotionals or (current_user.church_role and current_user.church_role.name in ['Administrador Global', 'Pastor Líder'])

def can_manage_kids():
    return current_user.can_manage_kids or (current_user.church_role and current_user.church_role.name in ['Administrador Global', 'Pastor Líder'])

def can_manage_media():
    is_leader = any(m.leader_id == current_user.id for m in current_user.ministries)
    return current_user.can_manage_media or (current_user.church_role and current_user.church_role.name in ['Administrador Global', 'Pastor Líder']) or is_leader

@edification_bp.route('/studies')
@login_required
def list_studies():
    studies = Study.query.order_by(Study.created_at.desc()).all()
    return render_template('edification/studies.html', studies=studies)

@edification_bp.route('/study/<int:id>')
@login_required
def view_study(id):
    study = Study.query.get_or_404(id)
    content_html = markdown.markdown(study.content)
    return render_template('edification/view_study.html', study=study, content_html=content_html)

@edification_bp.route('/kids')
@login_required
def kids_corner():
    activities = KidsActivity.query.order_by(KidsActivity.created_at.desc()).all()
    return render_template('edification/kids.html', activities=activities)

@edification_bp.route('/kids/add', methods=['GET', 'POST'])
@login_required
def add_kids_activity():
    if not can_manage_kids():
        flash('Acesso negado.', 'danger')
        return redirect(url_for('edification.kids_corner'))
        
    if request.method == 'POST':
        new_act = KidsActivity(
            title=request.form.get('title'),
            content=request.form.get('content'),
            age_group=request.form.get('age_group')
        )
        db.session.add(new_act)
        db.session.commit()
        flash('Atividade infantil publicada!', 'success')
        return redirect(url_for('edification.kids_corner'))
    return render_template('edification/add_kids.html')

@edification_bp.route('/study/add', methods=['GET', 'POST'])
@login_required
def add_study():
    if not can_manage_content():
        flash('Acesso negado.', 'danger')
        return redirect(url_for('edification.list_studies'))
        
    if request.method == 'POST':
        new_study = Study(
            title=request.form.get('title'),
            content=request.form.get('content'),
            category=request.form.get('category'),
            author_id=current_user.id
        )
        db.session.add(new_study)
        db.session.commit()
        flash('Estudo bíblico publicado!', 'success')
        return redirect(url_for('edification.list_studies'))
    return render_template('edification/add_study.html')

@edification_bp.route('/gallery')
@login_required
def gallery():
    ministry_id = request.args.get('ministry_id', type=int)
    
    query = Media.query.filter_by(church_id=current_user.church_id)
    if ministry_id:
        query = query.filter_by(ministry_id=ministry_id)
        
    media_items = query.order_by(Media.created_at.desc()).all()
    ministries = Ministry.query.filter_by(church_id=current_user.church_id).all()
    
    return render_template('edification/gallery.html', media_items=media_items, ministries=ministries)

@edification_bp.route('/media/add', methods=['GET', 'POST'])
@login_required
def add_media():
    if not can_manage_media():
        flash('Acesso negado.', 'danger')
        return redirect(url_for('edification.gallery'))
        
    if request.method == 'POST':
        file = request.files.get('file')
        if not file or file.filename == '':
            flash('Nenhum arquivo selecionado.', 'danger')
            return redirect(request.url)
        
        if not allowed_file(file.filename):
            flash('Tipo de arquivo não permitido.', 'danger')
            return redirect(request.url)
        
        filename = secure_filename(file.filename)
        upload_folder = os.path.join(current_app.config['UPLOAD_FOLDER'], 'media')
        os.makedirs(upload_folder, exist_ok=True)
        file.save(os.path.join(upload_folder, filename))
        
        new_media = Media(
            title=request.form.get('title'),
            description=request.form.get('description'),
            file_path=filename,
            media_type='video' if filename.lower().endswith('.mp4') else ('pdf' if filename.lower().endswith('.pdf') else 'image'),
            event_name=request.form.get('event_name'),
            church_id=current_user.church_id,
            ministry_id=request.form.get('ministry_id') if request.form.get('ministry_id') else None
        )
        db.session.add(new_media)
        db.session.commit()
        flash('Mídia adicionada com sucesso!', 'success')
        return redirect(url_for('edification.gallery'))
        
    my_ministries = [m for m in current_user.ministries if m.leader_id == current_user.id]
    if not my_ministries and (current_user.can_manage_media or (current_user.church_role and current_user.church_role.name in ['Administrador Global', 'Pastor Líder'])):
        my_ministries = Ministry.query.filter_by(church_id=current_user.church_id).all()
        
    return render_template('edification/add_media.html', ministries=my_ministries)

\n\n===== ./app/modules/admin/routes.py =====
from flask import Blueprint, render_template, redirect, url_for, flash, request
from flask_login import login_required, current_user
from app.core.models import Church, db, User, ChurchRole

admin_bp = Blueprint('admin', __name__)

def is_global_admin():
    return current_user.church_role and current_user.church_role.name == 'Administrador Global'

@admin_bp.route('/churches')
@login_required
def list_churches():
    if not is_global_admin():
        flash('Acesso negado.', 'danger')
        return redirect(url_for('members.dashboard'))
    churches = Church.query.all()
    return render_template('admin/churches.html', churches=churches)

@admin_bp.route('/church/add', methods=['GET', 'POST'])
@login_required
def add_church():
    if not is_global_admin():
        flash('Acesso negado.', 'danger')
        return redirect(url_for('members.dashboard'))
    
    if request.method == 'POST':
        new_church = Church(
            name=request.form.get('name'),
            address=request.form.get('address'),
            city=request.form.get('city'),
            country=request.form.get('country'),
            is_main=True if request.form.get('is_main') else False
        )
        db.session.add(new_church)
        db.session.commit()
        flash('Congregação cadastrada com sucesso!', 'success')
        return redirect(url_for('admin.list_churches'))
    
    return render_template('admin/add_church.html')

@admin_bp.route('/church/edit/<int:id>', methods=['GET', 'POST'])
@login_required
def edit_church(id):
    if not is_global_admin():
        flash('Acesso negado.', 'danger')
        return redirect(url_for('admin.list_churches'))
    
    church = Church.query.get_or_404(id)
    
    if request.method == 'POST':
        church.name = request.form.get('name')
        church.address = request.form.get('address')
        church.city = request.form.get('city')
        church.country = request.form.get('country')
        church.is_main = 'is_main' in request.form
        db.session.commit()
        flash('Congregação atualizada!', 'success')
        return redirect(url_for('admin.list_churches'))
    
    return render_template('admin/edit_church.html', church=church)

@admin_bp.route('/members')
@login_required
def list_members():
    if not is_global_admin():
        flash('Acesso negado.', 'danger')
        return redirect(url_for('members.dashboard'))
    
    members = User.query.all()
    return render_template('admin/members.html', members=members)

@admin_bp.route('/member/edit/<int:id>', methods=['GET', 'POST'])
@login_required
def edit_member(id):
    if not is_global_admin():
        flash('Acesso negado.', 'danger')
        return redirect(url_for('members.dashboard'))
    
    member = User.query.get_or_404(id)
    churches = Church.query.all()
    roles = ChurchRole.query.filter_by(church_id=member.church_id).order_by(ChurchRole.order, ChurchRole.name).all() if member.church_id else []
    
    if request.method == 'POST':
        member.name = request.form.get('name')
        member.email = request.form.get('email')
        member.church_role_id = int(request.form.get('church_role_id')) if request.form.get('church_role_id') else None
        member.church_id = int(request.form.get('church_id')) if request.form.get('church_id') else None
        member.status = request.form.get('status')
        db.session.commit()
        flash('Membro atualizado com sucesso!', 'success')
        return redirect(url_for('admin.list_members'))
    
    return render_template('admin/edit_member.html', member=member, churches=churches, roles=roles)

@admin_bp.route('/roles')
@login_required
def list_roles():
    if not current_user.church_role or current_user.church_role.name not in ['Administrador Global', 'Pastor Líder']:
        flash('Acesso negado.', 'danger')
        return redirect(url_for('members.dashboard'))
    
    roles = ChurchRole.query.filter_by(church_id=current_user.church_id).order_by(ChurchRole.order, ChurchRole.name).all()
    return render_template('admin/list_roles.html', roles=roles)

@admin_bp.route('/role/add', methods=['GET', 'POST'])
@login_required
def add_role():
    if not current_user.church_role or current_user.church_role.name not in ['Administrador Global', 'Pastor Líder']:
        flash('Acesso negado.', 'danger')
        return redirect(url_for('admin.list_roles'))
    
    if request.method == 'POST':
        new_role = ChurchRole(
            name=request.form.get('name'),
            description=request.form.get('description'),
            order=int(request.form.get('order')) if request.form.get('order') else 0,
            church_id=current_user.church_id
        )
        db.session.add(new_role)
        db.session.commit()
        flash('Cargo criado com sucesso!', 'success')
        return redirect(url_for('admin.list_roles'))
    
    return render_template('admin/add_role.html')

@admin_bp.route('/role/edit/<int:id>', methods=['GET', 'POST'])
@login_required
def edit_role(id):
    role = ChurchRole.query.get_or_404(id)
    
    if not current_user.church_role or current_user.church_role.name not in ['Administrador Global', 'Pastor Líder'] or role.church_id != current_user.church_id:
        flash('Acesso negado.', 'danger')
        return redirect(url_for('admin.list_roles'))
    
    if request.method == 'POST':
        role.name = request.form.get('name')
        role.description = request.form.get('description')
        role.order = int(request.form.get('order')) if request.form.get('order') else 0
        role.is_active = 'is_active' in request.form
        db.session.commit()
        flash('Cargo atualizado!', 'success')
        return redirect(url_for('admin.list_roles'))
    
    return render_template('admin/edit_role.html', role=role)

@admin_bp.route('/role/delete/<int:id>')
@login_required
def delete_role(id):
    role = ChurchRole.query.get_or_404(id)
    
    if not current_user.church_role or current_user.church_role.name not in ['Administrador Global', 'Pastor Líder'] or role.church_id != current_user.church_id:
        flash('Acesso negado.', 'danger')
        return redirect(url_for('admin.list_roles'))
    
    db.session.delete(role)
    db.session.commit()
    flash('Cargo excluído com sucesso!', 'success')
    return redirect(url_for('admin.list_roles'))

\n\n===== ./app/static/css/premium.css =====
:root {
    --primary: #4f46e5;
    --primary-hover: #4338ca;
    --secondary: #64748b;
    --success: #10b981;
    --danger: #ef4444;
    --warning: #f59e0b;
    --info: #06b6d4;
    --bg-main: #f8fafc;
    --bg-card: #ffffff;
    --text-main: #1e293b;
    --text-muted: #64748b;
    --border: #e2e8f0;
    --sidebar-bg: #1e293b;
    --sidebar-text: #f8fafc;
    --input-bg: #ffffff;
}

[data-theme="dark"] {
    --bg-main: #0f172a;
    --bg-card: #1e293b;
    --text-main: #f8fafc;
    --text-muted: #94a3b8;
    --border: #334155;
    --sidebar-bg: #020617;
    --input-bg: #334155;
}

body {
    font-family: 'Inter', sans-serif;
    background-color: var(--bg-main);
    color: var(--text-main);
    transition: all 0.3s ease;
}

.sidebar {
    background-color: var(--sidebar-bg);
    color: var(--sidebar-text);
    min-height: 100vh;
    padding: 2rem 1rem;
}

.nav-link {
    color: var(--sidebar-text);
    opacity: 0.7;
    transition: all 0.2s;
    border-radius: 0.5rem;
    margin-bottom: 0.5rem;
}

.nav-link:hover, .nav-link.active {
    opacity: 1;
    background-color: rgba(255,255,255,0.1);
    color: white;
}

.main-content {
    padding: 2rem;
}

.card {
    background-color: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 1rem;
    box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
    transition: transform 0.2s;
}

.card:hover {
    transform: translateY(-2px);
}

.btn-primary {
    background-color: var(--primary);
    border-color: var(--primary);
}

.btn-primary:hover {
    background-color: var(--primary-hover);
}

.stats-card {
    padding: 1.5rem;
    display: flex;
    align-items: center;
    gap: 1rem;
}

.stats-icon {
    width: 3rem;
    height: 3rem;
    border-radius: 0.75rem;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
}

/* Form Controls Dark Mode */
.form-control, .form-select {
    background-color: var(--input-bg);
    border-color: var(--border);
    color: var(--text-main);
}

.form-control:focus, .form-select:focus {
    background-color: var(--input-bg);
    color: var(--text-main);
    border-color: var(--primary);
    box-shadow: 0 0 0 0.25rem rgba(79, 70, 229, 0.25);
}

/* Table Dark Mode */
.table {
    color: var(--text-main);
}

.table thead th {
    background-color: var(--bg-main);
    border-bottom-color: var(--border);
    color: var(--text-muted);
}

.table td {
    border-bottom-color: var(--border);
}

/* Study Content Styling */
.study-content {
    line-height: 1.8;
    font-size: 1.1rem;
}

.study-content h1, .study-content h2 {
    margin-top: 2rem;
    margin-bottom: 1rem;
    font-weight: 700;
}

.devotional-card {
    background: linear-gradient(135deg, var(--primary), var(--info));
    color: white;
}

/* Theme Toggle */
.theme-toggle {
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 50%;
    background: var(--border);
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
}

/* Image Placeholders */
.img-placeholder {
    background-color: var(--border);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-muted);
    border-radius: 0.5rem;
}

.church-logo {
    width: 48px;
    height: 48px;
    object-fit: contain;
}

\n\n===== ./app/templates/base.html =====
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ecclesia Master - Gestão Eclesiástica</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/premium.css') }}">
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            {% if current_user.is_authenticated %}
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 sidebar d-none d-md-block">
                <div class="d-flex align-items-center mb-4 px-2">
                    <i class="bi bi-lightning-charge-fill text-primary fs-3 me-2"></i>
                    <h4 class="mb-0 fw-bold">Ecclesia</h4>
                </div>
                <nav class="nav flex-column">
                    <a class="nav-link {{ 'active' if request.endpoint == 'members.dashboard' }}" href="{{ url_for('members.dashboard') }}">
                        <i class="bi bi-speedometer2 me-2"></i> Dashboard
                    </a>
                    <a class="nav-link {{ 'active' if 'finance' in request.endpoint }}" href="{{ url_for('finance.dashboard') }}">
                        <i class="bi bi-cash-stack me-2"></i> Financeiro
                    </a>
                    <a class="nav-link {{ 'active' if 'edification' in request.endpoint }}" href="{{ url_for('edification.list_studies') }}">
                        <i class="bi bi-book me-2"></i> Edificação
                    </a>
                    <a class="nav-link {{ 'active' if 'gallery' in request.endpoint }}" href="{{ url_for('edification.gallery') }}">
                        <i class="bi bi-images me-2"></i> Galeria
                    </a>
                    <a class="nav-link {{ 'active' if 'ministries' in request.endpoint }}" href="{{ url_for('members.list_ministries') }}">
                        <i class="bi bi-diagram-3 me-2"></i> Ministérios
                    </a>
                    {% if current_user.can_approve_members or (current_user.church_role and current_user.church_role.name in ['Administrador Global', 'Pastor Líder']) %}
                    <a class="nav-link {{ 'active' if 'church_members' in request.endpoint }}" href="{{ url_for('members.church_members') }}">
                        <i class="bi bi-people me-2"></i> Membros da Filial
                    </a>
                    {% endif %}

                    <!-- Link "Meus Ministérios Liderados" - aparece se o usuário é líder de algum ministério -->
                    {% if current_user.is_authenticated %}
                        {% set has_led_ministries = namespace(value=false) %}
                        {% for ministry in current_user.ministries %}
                            {% if ministry.leader_id == current_user.id %}
                                {% set has_led_ministries.value = true %}
                            {% endif %}
                        {% endfor %}
                        {% if has_led_ministries.value %}
                        <a class="nav-link {{ 'active' if 'my_led_ministries' in request.endpoint }}" href="{{ url_for('members.my_led_ministries') }}">
                            <i class="bi bi-star-fill me-2"></i> Meus Ministérios Liderados
                        </a>
                        {% endif %}
                    {% endif %}

                    {% if current_user.can_approve_members or (current_user.church_role and current_user.church_role.name in ['Administrador Global', 'Pastor Líder']) %}
                    <a class="nav-link {{ 'active' if 'roles' in request.endpoint }}" href="{{ url_for('admin.list_roles') }}">
                        <i class="bi bi-person-badge me-2"></i> Cargos da Congregação
                    </a>
                    {% endif %}

                    {% if current_user.church_role and current_user.church_role.name == 'Administrador Global' %}
                    <hr class="my-3 opacity-25">
                    <label class="small text-muted px-3 mb-2">ADMINISTRAÇÃO</label>
                    <a class="nav-link {{ 'active' if 'admin.list_churches' in request.endpoint }}" href="{{ url_for('admin.list_churches') }}">
                        <i class="bi bi-building me-2"></i> Congregações
                    </a>
                    <a class="nav-link {{ 'active' if 'admin.list_members' in request.endpoint }}" href="{{ url_for('admin.list_members') }}">
                        <i class="bi bi-globe me-2"></i> Gestão Global
                    </a>
                    {% endif %}

                    <a class="nav-link" href="{{ url_for('members.profile') }}">
                        <i class="bi bi-person me-2"></i> Meu Perfil
                    </a>
                    <hr class="my-3 opacity-25">
                    <a class="nav-link text-danger" href="{{ url_for('auth.logout') }}">
                        <i class="bi bi-box-arrow-right me-2"></i> Sair
                    </a>
                </nav>
            </div>
            {% endif %}

            <!-- Main Content -->
            <div class="col-md-9 col-lg-10 main-content {{ 'mx-auto' if not current_user.is_authenticated }}">
                <header class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                        {% if current_user.is_authenticated %}
                        <h5 class="text-muted mb-0">Bem-vindo,</h5>
                        <h3 class="fw-bold">{{ current_user.name }}</h3>
                        {% endif %}
                    </div>
                    <div class="d-flex align-items-center gap-3">
                        <div class="theme-toggle" onclick="toggleTheme()">
                            <i class="bi bi-moon-stars" id="theme-icon"></i>
                        </div>
                    </div>
                </header>

                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="alert alert-{{ category }} alert-dismissible fade show rounded-3" role="alert">
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}

                {% block content %}{% endblock %}
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function toggleTheme() {
            const html = document.documentElement;
            const icon = document.getElementById('theme-icon');
            if (html.getAttribute('data-theme') === 'dark') {
                html.removeAttribute('data-theme');
                icon.className = 'bi bi-moon-stars';
                localStorage.setItem('theme', 'light');
            } else {
                html.setAttribute('data-theme', 'dark');
                icon.className = 'bi bi-sun';
                localStorage.setItem('theme', 'dark');
            }
        }

        if (localStorage.getItem('theme') === 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark');
            document.getElementById('theme-icon').className = 'bi bi-sun';
        }
    </script>
</body>
</html>
\n\n===== ./app/templates/members/dashboard.html =====
{% extends "base.html" %}
{% block content %}
<div class="row g-4">
    <!-- Seção de Alertas para Liderança -->
    {% if pending_members %}
    <div class="col-12">
        <div class="alert alert-warning border-0 shadow-sm d-flex justify-content-between align-items-center">
            <div>
                <i class="bi bi-person-plus-fill me-2"></i>
                Existem <strong>{{ pending_members|length }}</strong> solicitações de cadastro pendentes para sua filial.
            </div>
            <button class="btn btn-sm btn-warning fw-bold" data-bs-toggle="modal" data-bs-target="#pendingModal">Ver Solicitações</button>
        </div>
    </div>
    {% endif %}

    <!-- Devocional e Agenda -->
    <div class="col-lg-8">
        <div class="card devotional-card border-0 p-4 mb-4">
            <div class="card-body">
                <span class="badge bg-white text-primary px-3 py-2 mb-3">Palavra do Dia</span>
                {% if devotional and devotional.date == datetime.utcnow().date() %}
                    <h2 class="fw-bold mb-3">{{ devotional.title }}</h2>
                    <p class="fs-5 opacity-90">{{ devotional.content | safe }}</p>
                    {% if devotional.verse %}
                    <p class="fst-italic mt-3 mb-0">"{{ devotional.verse }}"</p>
                    {% endif %}
                {% elif devotional %}
                    <h2 class="fw-bold mb-3">{{ devotional.title }}</h2>
                    <p class="fs-5 opacity-90">{{ devotional.content | safe }}</p>
                    {% if devotional.verse %}
                    <p class="fst-italic mt-3 mb-0">"{{ devotional.verse }}"</p>
                    {% endif %}
                    <div class="alert alert-info mt-3">
                        <i class="bi bi-info-circle me-2"></i>
                        Este é o devocional mais recente. O de hoje ainda não foi publicado.
                    </div>
                {% else %}
                    <h2 class="fw-bold mb-3">Bem-vindo ao Ecclesia Master</h2>
                    <p class="fs-5 opacity-90">Que a graça do Senhor Jesus seja com todos.</p>
                    <div class="alert alert-warning mt-3">
                        <i class="bi bi-exclamation-triangle me-2"></i>
                        Nenhum devocional publicado ainda.
                    </div>
                {% endif %}
            </div>
        </div>

        <div class="card border-0 shadow-sm p-4">
            <h4 class="fw-bold mb-4"><i class="bi bi-calendar-event me-2 text-primary"></i>Minha Agenda</h4>
            <div class="list-group list-group-flush">
                {% for event in agenda %}
                <div class="list-group-item px-0 py-3 border-0 border-bottom">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="fw-bold mb-1">{{ event.title }}</h6>
                            <small class="text-muted">
                                <i class="bi bi-clock me-1"></i> {{ event.start_time.strftime('%d/%m %H:%M') }}
                                {% if event.ministry %}
                                <span class="badge bg-info bg-opacity-10 text-info ms-2">{{ event.ministry.name }}</span>
                                {% else %}
                                <span class="badge bg-secondary bg-opacity-10 text-secondary ms-2">Geral</span>
                                {% endif %}
                            </small>
                        </div>
                        <div class="text-end">
                            <small class="d-block text-muted"><i class="bi bi-geo-alt"></i> {{ event.location }}</small>
                        </div>
                    </div>
                </div>
                {% else %}
                <p class="text-muted">Nenhum evento agendado para você.</p>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Sidebar de Ações e Família -->
    <div class="col-lg-4">
        <div class="card border-0 shadow-sm p-4 mb-4">
            <h5 class="fw-bold mb-3">Painel de Liderança</h5>
            <div class="d-grid gap-2">
                {% if current_user.can_manage_ministries %}
                <a href="{{ url_for('members.add_ministry') }}" class="btn btn-outline-primary text-start">
                    <i class="bi bi-plus-circle me-2"></i> Criar Ministério
                </a>
                {% endif %}

                {% if current_user.can_manage_events or current_user.can_manage_ministries %}
                <a href="{{ url_for('members.add_general_event') }}" class="btn btn-outline-success text-start">
                    <i class="bi bi-calendar-plus me-2"></i> Criar Evento Geral da Igreja
                </a>
                {% endif %}

                {% if current_user.can_manage_finance %}
                <a href="{{ url_for('finance.add_transaction') }}" class="btn btn-outline-success text-start">
                    <i class="bi bi-cash-coin me-2"></i> Lançar Financeiro
                </a>
                <a href="{{ url_for('finance.add_asset') }}" class="btn btn-outline-info text-start">
                    <i class="bi bi-box-seam me-2"></i> Cadastrar Patrimônio
                </a>
                {% endif %}

                {% if current_user.can_manage_media %}
                <a href="{{ url_for('edification.add_media') }}" class="btn btn-outline-info text-start">
                    <i class="bi bi-images me-2"></i> Adicionar Mídia à Galeria
                </a>
                {% endif %}

                <a href="{{ url_for('edification.kids_corner') }}" class="btn btn-outline-warning text-start">
                    <i class="bi bi-balloon me-2"></i> Ecclesia Kids
                </a>
            </div>
        </div>

        <div class="card border-0 shadow-sm p-4">
            <h5 class="fw-bold mb-3"><i class="bi bi-people me-2 text-primary"></i>Minha Família</h5>
            {% if current_user.family_group %}
                <p class="text-muted small mb-3">Grupo: <strong>{{ current_user.family_group.name }}</strong></p>
                <div class="list-group list-group-flush">
                    {% for member in current_user.family_group.users %}
                    <div class="list-group-item px-0 py-2 border-0 small">
                        <i class="bi bi-person-circle me-2"></i> {{ member.name }}
                        {% if member.id == current_user.id %}<span class="badge bg-light text-dark ms-1">Você</span>{% endif %}
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="text-muted small">Você ainda não está vinculado a um grupo familiar.</p>
            {% endif %}
        </div>
    </div>
</div>

<!-- Modal de Solicitações Pendentes -->
<div class="modal fade" id="pendingModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content border-0 shadow">
            <div class="modal-header bg-light">
                <h5 class="modal-title fw-bold">Solicitações de Cadastro</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="table-responsive">
                    <table class="table align-middle">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>E-mail</th>
                                <th>Data Solicitada</th>
                                <th class="text-end">Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for p in pending_members %}
                            <tr>
                                <td>{{ p.name }}</td>
                                <td>{{ p.email }}</td>
                                <td>{{ p.birth_date.strftime('%d/%m/%Y') if p.birth_date else 'N/A' }}</td>
                                <td class="text-end">
                                    <a href="{{ url_for('auth.approve_member', user_id=p.id, action='approve') }}" class="btn btn-sm btn-success">Aprovar</a>
                                    <a href="{{ url_for('auth.approve_member', user_id=p.id, action='reject') }}" class="btn btn-sm btn-danger">Rejeitar</a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
\n\n===== ./app/templates/members/profile.html =====
{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card border-0 shadow-sm p-4 p-md-5">
            <div class="text-center mb-4">
                <div class="d-inline-block bg-primary bg-opacity-10 rounded-circle p-4 mb-3">
                    <i class="bi bi-person-fill text-primary fs-1"></i>
                </div>
                <h2 class="fw-bold">{{ current_user.name }}</h2>
                <span class="badge bg-primary px-3 py-2">{{ current_user.church_role.name if current_user.church_role else 'Sem cargo' }}</span>
            </div>

            <hr class="my-4 opacity-25">

            <div class="row g-4">
                <div class="col-md-6">
                    <label class="form-label small fw-bold text-muted">E-MAIL</label>
                    <p class="fs-5">{{ current_user.email }}</p>
                </div>
                <div class="col-md-6">
                    <label class="form-label small fw-bold text-muted">TELEFONE</label>
                    <p class="fs-5">{{ current_user.phone or 'Não informado' }}</p>
                </div>
                <div class="col-md-6">
                    <label class="form-label small fw-bold text-muted">DATA DE NASCIMENTO</label>
                    <p class="fs-5">{{ current_user.birth_date.strftime('%d/%m/%Y') if current_user.birth_date else 'Não informado' }}</p>
                </div>
                <div class="col-md-6">
                    <label class="form-label small fw-bold text-muted">CONGREGAÇÃO</label>
                    <p class="fs-5">{{ current_user.church.name if current_user.church else 'Não vinculada' }}</p>
                </div>
                <div class="col-12">
                    <label class="form-label small fw-bold text-muted">ENDEREÇO</label>
                    <p class="fs-5">{{ current_user.address or 'Não informado' }}</p>
                </div>
                <div class="col-12">
                    <label class="form-label small fw-bold text-muted">DOCUMENTOS</label>
                    <p class="fs-5">{{ current_user.documents or 'Não informado' }}</p>
                </div>
            </div>

            <div class="mt-4 d-flex gap-2">
                <a href="{{ url_for('auth.change_password') }}" class="btn btn-outline-primary btn-sm">
                    <i class="bi bi-key me-1"></i> Alterar Minha Senha
                </a>
            </div>

            <div class="mt-5 pt-4 border-top">
                <h5 class="fw-bold mb-3">Meus Ministérios</h5>
                <div class="d-flex flex-wrap gap-2">
                    {% for ministry in current_user.ministries %}
                    <span class="badge bg-info bg-opacity-10 text-info px-3 py-2">{{ ministry.name }}</span>
                    {% else %}
                    <p class="text-muted small">Você ainda não faz parte de nenhum ministério.</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
\n\n===== ./app/templates/members/add_ministry.html =====
{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card border-0 shadow-sm p-4">
            <h3 class="fw-bold mb-4">Novo Ministério</h3>
            <form method="POST">
                <div class="mb-3">
                    <label class="form-label small fw-bold">NOME DO MINISTÉRIO</label>
                    <input type="text" name="name" class="form-control bg-light border-0" placeholder="Ex: Ministério de Louvor, Grupo de Jovens" required>
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">DESCRIÇÃO</label>
                    <textarea name="description" class="form-control bg-light border-0" rows="3" placeholder="Descreva as responsabilidades..."></textarea>
                </div>
                {% if churches %}
                <div class="mb-3">
                    <label class="form-label small fw-bold">FILIAL / CONGREGAÇÃO</label>
                    <select name="church_id" class="form-select bg-light border-0" required>
                        <option value="">Selecione uma filial...</option>
                        {% for church in churches %}
                        <option value="{{ church.id }}">{{ church.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                {% endif %}
                <div class="mb-3">
                    <label class="form-label small fw-bold">LÍDER DO MINISTÉRIO</label>
                    <select name="leader_id" class="form-select bg-light border-0" required>
                        <option value="">Selecione um líder...</option>
                        {% for leader in leaders %}
                        <option value="{{ leader.id }}">{{ leader.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="d-grid mt-4">
                    <button type="submit" class="btn btn-primary btn-lg py-3 fw-bold shadow-sm">
                        Cadastrar Ministério
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
\n\n===== ./app/templates/members/add_event.html =====
{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card border-0 shadow-sm p-4">
            <h3 class="fw-bold mb-2">Agendar Evento</h3>
            <p class="text-muted mb-4">Ministério: <strong>{{ ministry.name }}</strong></p>
            <form method="POST">
                <div class="mb-3">
                    <label class="form-label small fw-bold">TÍTULO DO EVENTO</label>
                    <input type="text" name="title" class="form-control bg-light border-0" placeholder="Ex: Ensaio Geral, Reunião de Líderes" required>
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">DATA E HORA</label>
                    <input type="datetime-local" name="start_time" class="form-control bg-light border-0" required>
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">LOCAL</label>
                    <input type="text" name="location" class="form-control bg-light border-0" placeholder="Ex: Templo Sede, Sala 02" required>
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">DESCRIÇÃO / OBSERVAÇÕES</label>
                    <textarea name="description" class="form-control bg-light border-0" rows="3"></textarea>
                </div>
                <div class="d-grid mt-4">
                    <button type="submit" class="btn btn-primary btn-lg py-3 fw-bold shadow-sm">
                        Confirmar Agendamento
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

\n\n===== ./app/templates/members/ministries.html =====
{% extends "base.html" %}
{% block content %}
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-5">
        <div>
            <h1 class="fw-bold text-primary"><i class="bi bi-diagram-3-fill me-2"></i>Ministérios</h1>
            <p class="text-muted">Departamentos e grupos de serviço da nossa igreja.</p>
        </div>
        {% if current_user.can_manage_ministries or (current_user.church_role and current_user.church_role.name in ['Administrador Global', 'Pastor Líder']) %}
        <a href="{{ url_for('members.add_ministry') }}" class="btn btn-primary fw-bold">
            <i class="bi bi-plus-lg me-2"></i> Novo Ministério
        </a>
        {% endif %}
    </div>

    <div class="row g-4">
        {% for ministry in ministries %}
        <div class="col-md-6 col-lg-4">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-body p-4">
                    <h5 class="fw-bold mb-2">{{ ministry.name }}</h5>
                    <p class="text-muted small mb-4">{{ ministry.description }}</p>
                    
                    <div class="mb-4">
                        <label class="small fw-bold text-muted d-block mb-1">LÍDER</label>
                        <div class="d-flex align-items-center">
                            <i class="bi bi-person-badge me-2 text-primary"></i>
                            <span>{{ ministry.leader.name if ministry.leader else 'Sem líder definido' }}</span>
                        </div>
                    </div>

                    <div class="d-grid gap-2">
                        {% if ministry.leader_id == current_user.id or current_user.can_manage_ministries or (current_user.church_role and current_user.church_role.name in ['Administrador Global', 'Pastor Líder']) %}
                        <a href="{{ url_for('members.add_ministry_event', id=ministry.id) }}" class="btn btn-sm btn-outline-primary">
                            <i class="bi bi-calendar-plus me-1"></i> Agendar Evento
                        </a>
                        <a href="{{ url_for('edification.add_media', ministry_id=ministry.id) }}" class="btn btn-sm btn-outline-info">
                            <i class="bi bi-upload me-1"></i> Upload de Mídia
                        </a>
                        <a href="{{ url_for('members.edit_ministry', id=ministry.id) }}" class="btn btn-sm btn-outline-secondary">
                            <i class="bi bi-pencil me-1"></i> Editar
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% else %}
        <div class="col-12 text-center py-5">
            <i class="bi bi-people fs-1 text-muted opacity-50 d-block mb-3"></i>
            <p class="text-muted">Nenhum ministério cadastrado.</p>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}

\n\n===== ./app/templates/members/church_members.html =====
{% extends "base.html" %}
{% block content %}
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-5">
        <div>
            <h1 class="fw-bold text-primary"><i class="bi bi-people-fill me-2"></i>Membros da Congregação</h1>
            <p class="text-muted">Gerencie os membros vinculados à sua filial.</p>
        </div>
    </div>

    <div class="card border-0 shadow-sm">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="bg-light">
                    <tr>
                        <th class="ps-4">Nome</th>
                        <th>E-mail</th>
                        <th>Cargo Atual</th>
                        <th>Status</th>
                        <th class="text-end pe-4">Ações</th>
                    </tr>
                </thead>
                <tbody>
                    {% for member in members %}
                    <tr>
                        <td class="ps-4 fw-bold">{{ member.name }}</td>
                        <td>{{ member.email }}</td>
                        <td><span class="badge bg-info bg-opacity-10 text-info">{{ member.church_role.name if member.church_role else 'Sem cargo' }}</span></td>
                        <td>
                            {% if member.status == 'active' %}
                            <span class="badge bg-success">Ativo</span>
                            {% elif member.status == 'pending' %}
                            <span class="badge bg-warning">Pendente</span>
                            {% else %}
                            <span class="badge bg-danger">Inativo</span>
                            {% endif %}
                        </td>
                        <td class="text-end pe-4">
                            <a href="{{ url_for('members.promote_member', id=member.id) }}" class="btn btn-sm btn-outline-primary">Alterar Cargo</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
\n\n===== ./app/templates/members/promote_member.html =====
{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card border-0 shadow-sm p-4">
            <h3 class="fw-bold mb-4">Alterar Cargo e Permissões</h3>
            <form method="POST">
                <div class="mb-3">
                    <label class="form-label small fw-bold">NOVO CARGO</label>
                    <select name="church_role_id" class="form-select bg-light border-0">
                        <option value="">Sem cargo</option>
                        {% for role in roles %}
                        <option value="{{ role.id }}" {{ 'selected' if member.church_role_id == role.id }}>{{ role.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <p class="small text-muted mb-4"><i class="bi bi-info-circle me-1"></i> Alterar o cargo mudará as permissões de acesso deste usuário no sistema.</p>
                
                <!-- Nova seção: Permissões Especiais -->
                <div class="mb-4">
                    <h5 class="fw-bold mb-3">Permissões Especiais</h5>
                    <div class="form-check">
                        <input type="checkbox" name="can_manage_ministries" class="form-check-input" id="can_ministries" {{ 'checked' if member.can_manage_ministries }}>
                        <label class="form-check-label" for="can_ministries">Pode gerenciar ministérios</label>
                    </div>
                    <div class="form-check">
                        <input type="checkbox" name="can_manage_media" class="form-check-input" id="can_media" {{ 'checked' if member.can_manage_media }}>
                        <label class="form-check-label" for="can_media">Pode gerenciar mídia/galeria</label>
                    </div>
                    <div class="form-check">
                        <input type="checkbox" name="can_publish_devotionals" class="form-check-input" id="can_dev" {{ 'checked' if member.can_publish_devotionals }}>
                        <label class="form-check-label" for="can_dev">Pode publicar devocionais</label>
                    </div>
                    <div class="form-check">
                        <input type="checkbox" name="can_manage_finance" class="form-check-input" id="can_finance" {{ 'checked' if member.can_manage_finance }}>
                        <label class="form-check-label" for="can_finance">Pode gerenciar financeiro</label>
                    </div>
                    <div class="form-check">
                        <input type="checkbox" name="can_manage_events" class="form-check-input" id="can_events" {{ 'checked' if member.can_manage_events }}>
                        <label class="form-check-label" for="can_events">Pode gerenciar eventos</label>
                    </div>
                </div>

                <div class="d-grid mt-4">
                    <button type="submit" class="btn btn-primary btn-lg py-3 fw-bold shadow-sm">
                        Confirmar Alteração
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
\n\n===== ./app/templates/members/my_led_ministries.html =====
{% extends "base.html" %}
{% block content %}
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-5">
        <div>
            <h1 class="fw-bold text-primary"><i class="bi bi-star-fill me-2"></i>Meus Ministérios Liderados</h1>
            <p class="text-muted">Aqui você gerencia os ministérios nos quais é líder.</p>
        </div>
    </div>

    <div class="row g-4">
        {% for ministry in led_ministries %}
        <div class="col-md-6 col-lg-4">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-body p-4">
                    <h5 class="fw-bold mb-3">{{ ministry.name }}</h5>
                    <p class="text-muted small mb-4">{{ ministry.description or 'Sem descrição' }}</p>
                    
                    <div class="mb-4">
                        <label class="small fw-bold text-muted d-block mb-1">LÍDER</label>
                        <div class="d-flex align-items-center">
                            <i class="bi bi-person-badge me-2 text-primary"></i>
                            <span>Você</span>
                        </div>
                    </div>

                    <div class="d-grid gap-2">
                        <!-- Botões sempre aparecem para o líder -->
                        <a href="{{ url_for('members.ministry_manage_members', ministry_id=ministry.id) }}" class="btn btn-outline-primary">
                            <i class="bi bi-people me-1"></i> Gerenciar Membros
                        </a>
                        <a href="{{ url_for('members.ministry_agenda', ministry_id=ministry.id) }}" class="btn btn-outline-info">
                            <i class="bi bi-calendar-event me-1"></i> Agenda do Ministério
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% else %}
        <div class="col-12 text-center py-5">
            <i class="bi bi-star fs-1 text-muted opacity-50 d-block mb-3"></i>
            <p class="text-muted">Você ainda não lidera nenhum ministério.</p>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}
\n\n===== ./app/templates/members/edit_ministry.html =====
{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card border-0 shadow-sm p-4">
            <h3 class="fw-bold mb-4">Editar Ministério</h3>
            <form method="POST">
                <div class="mb-3">
                    <label class="form-label small fw-bold">NOME DO MINISTÉRIO</label>
                    <input type="text" name="name" class="form-control bg-light border-0" value="{{ ministry.name }}" required>
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">DESCRIÇÃO</label>
                    <textarea name="description" class="form-control bg-light border-0" rows="3">{{ ministry.description or '' }}</textarea>
                </div>
                {% if churches %}
                <div class="mb-3">
                    <label class="form-label small fw-bold">FILIAL / CONGREGAÇÃO</label>
                    <select name="church_id" class="form-select bg-light border-0" required>
                        <option value="">Selecione uma filial...</option>
                        {% for church in churches %}
                        <option value="{{ church.id }}" {{ 'selected' if ministry.church_id == church.id }}>{{ church.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                {% endif %}
                <div class="mb-3">
                    <label class="form-label small fw-bold">LÍDER DO MINISTÉRIO</label>
                    <select name="leader_id" class="form-select bg-light border-0" required>
                        <option value="">Selecione um líder...</option>
                        {% for leader in leaders %}
                        <option value="{{ leader.id }}" {{ 'selected' if ministry.leader_id == leader.id }}>{{ leader.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="d-grid mt-4">
                    <button type="submit" class="btn btn-primary btn-lg py-3 fw-bold shadow-sm">
                        Salvar Alterações
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
\n\n===== ./app/templates/members/ministry_manage_members.html =====
{% extends "base.html" %}
{% block content %}
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-5">
        <div>
            <h1 class="fw-bold text-primary"><i class="bi bi-people-fill me-2"></i>Gerenciar Membros - {{ ministry.name }}</h1>
            <p class="text-muted">Adicione ou remova membros deste ministério (apenas da mesma congregação).</p>
        </div>
        <a href="{{ url_for('members.my_led_ministries') }}" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left me-1"></i> Voltar aos Meus Ministérios
        </a>
    </div>

    <!-- Estatísticas -->
    <div class="row g-4 mb-5">
        <div class="col-md-4">
            <div class="card border-0 shadow-sm text-center p-4">
                <h5 class="fw-bold mb-1">Total de Membros</h5>
                <h2 class="display-5 fw-bold text-primary">{{ total_members }}</h2>
            </div>
        </div>
        <div class="col-md-8">
            <div class="card border-0 shadow-sm p-4">
                <h5 class="fw-bold mb-3">Distribuição por Gênero</h5>
                <div class="row g-3">
                    {% for gender, count in gender_count %}
                    <div class="col-md-4">
                        <div class="border rounded p-3 text-center">
                            <h6 class="mb-1">{{ gender or 'Não informado' }}</h6>
                            <h5 class="fw-bold">{{ count }}</h5>
                        </div>
                    </div>
                    {% endfor %}
                    {% if gender_count|length == 0 %}
                    <div class="col-12 text-center text-muted py-3">
                        Ainda não há membros neste ministério.
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Membros atuais -->
    <div class="card border-0 shadow-sm mb-5">
        <div class="card-header bg-light">
            <h5 class="mb-0">Membros Atuais</h5>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead class="bg-light">
                        <tr>
                            <th>Nome</th>
                            <th>Cargo</th>
                            <th class="text-end">Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for member in current_members %}
                        <tr>
                            <td class="fw-bold">{{ member.name }}</td>
                            <td>{{ member.church_role.name if member.church_role else 'Sem cargo' }}</td>
                            <td class="text-end">
                                <a href="{{ url_for('members.ministry_remove_member', ministry_id=ministry.id, user_id=member.id) }}" 
                                   class="btn btn-sm btn-outline-danger" 
                                   onclick="return confirm('Tem certeza que deseja remover {{ member.name }} deste ministério?');">
                                    <i class="bi bi-trash me-1"></i> Remover
                                </a>
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="3" class="text-center py-5 text-muted">
                                <i class="bi bi-people fs-1 d-block mb-2"></i>
                                Nenhum membro associado ainda.
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Form para adicionar membro -->
    <div class="card border-0 shadow-sm">
        <div class="card-header bg-light">
            <h5 class="mb-0">Adicionar Membro ao Ministério</h5>
        </div>
        <div class="card-body">
            <form method="POST" action="{{ url_for('members.ministry_add_member', ministry_id=ministry.id) }}">
                <div class="mb-3">
                    <label class="form-label small fw-bold">Selecione um membro da congregação</label>
                    <select name="user_id" class="form-select bg-light border-0" required>
                        <option value="">-- Escolha um membro --</option>
                        {% for member in available_members %}
                        <option value="{{ member.id }}">{{ member.name }} {% if member.church_role %}({{ member.church_role.name }}){% endif %}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="d-grid">
                    <button type="submit" class="btn btn-success btn-lg py-3 fw-bold">
                        <i class="bi bi-plus-circle me-2"></i> Adicionar ao Ministério
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
\n\n===== ./app/templates/members/ministry_agenda.html =====
{% extends "base.html" %}
{% block content %}
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-5">
        <div>
            <h1 class="fw-bold text-primary"><i class="bi bi-calendar-event-fill me-2"></i>Agenda - {{ ministry.name }}</h1>
            <p class="text-muted">Eventos exclusivos deste ministério e aviso de eventos gerais da congregação.</p>
        </div>
        <a href="{{ url_for('members.my_led_ministries') }}" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left me-1"></i> Voltar aos Meus Ministérios
        </a>
    </div>

    <!-- Eventos do Ministério -->
    <div class="card border-0 shadow-sm mb-5">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0">Eventos do {{ ministry.name }}</h5>
        </div>
        <div class="card-body p-0">
            <div class="list-group list-group-flush">
                {% for event in ministry_events %}
                <div class="list-group-item px-4 py-3 border-bottom">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="fw-bold mb-1">{{ event.title }}</h6>
                            <small class="text-muted d-block">
                                <i class="bi bi-clock me-1"></i> {{ event.start_time.strftime('%d/%m/%Y %H:%M') }}
                                <i class="bi bi-geo-alt ms-3 me-1"></i> {{ event.location }}
                            </small>
                        </div>
                        <span class="badge bg-primary bg-opacity-10 text-primary px-3 py-2">
                            {{ ministry.name }}
                        </span>
                    </div>
                    {% if event.description %}
                    <p class="text-muted small mt-2 mb-0">{{ event.description|truncate(120) }}</p>
                    {% endif %}
                </div>
                {% else %}
                <div class="text-center py-5 text-muted">
                    <i class="bi bi-calendar-x fs-1 d-block mb-2"></i>
                    Nenhum evento agendado para este ministério ainda.
                </div>
                {% endfor %}
            </div>
        </div>
        <div class="card-footer bg-light text-end">
            <a href="{{ url_for('members.add_ministry_event', id=ministry.id) }}" class="btn btn-sm btn-success">
                <i class="bi bi-plus-circle me-1"></i> Novo Evento para este Ministério
            </a>
        </div>
    </div>

    <!-- Aviso de Eventos Gerais -->
    {% if general_events %}
    <div class="alert alert-info border-0 shadow-sm">
        <h5 class="fw-bold mb-3"><i class="bi bi-info-circle me-2"></i>Eventos Gerais da Congregação</h5>
        <p class="mb-3">Estes eventos não são exclusivos do seu ministério, mas podem afetar todos os membros:</p>
        <ul class="list-group list-group-flush">
            {% for event in general_events %}
            <li class="list-group-item border-0 py-2">
                <strong>{{ event.title }}</strong> - 
                {{ event.start_time.strftime('%d/%m/%Y %H:%M') }} 
                {% if event.location %}em {{ event.location }}{% endif %}
            </li>
            {% endfor %}
        </ul>
    </div>
    {% else %}
    <div class="alert alert-light border">
        <i class="bi bi-info-circle me-2"></i>
        Nenhum evento geral agendado no momento.
    </div>
    {% endif %}
</div>
{% endblock %}
\n\n===== ./app/templates/members/add_general_event.html =====
{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card border-0 shadow-sm p-4">
            <h3 class="fw-bold mb-2">Agendar Evento Geral da Igreja</h3>
            <p class="text-muted mb-4">Este evento será visível para todos os membros da congregação.</p>
            <form method="POST">
                <div class="mb-3">
                    <label class="form-label small fw-bold">TÍTULO DO EVENTO</label>
                    <input type="text" name="title" class="form-control bg-light border-0" placeholder="Ex: Culto Dominical, Conferência Anual" required>
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">DATA E HORA</label>
                    <input type="datetime-local" name="start_time" class="form-control bg-light border-0" required>
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">LOCAL</label>
                    <input type="text" name="location" class="form-control bg-light border-0" placeholder="Ex: Templo Sede" required>
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">DESCRIÇÃO</label>
                    <textarea name="description" class="form-control bg-light border-0" rows="3"></textarea>
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">REPETIÇÃO</label>
                    <select name="recurrence" class="form-select bg-light border-0">
                        <option value="none">Sem repetição</option>
                        <option value="weekly">Semanal</option>
                        <option value="monthly">Mensal</option>
                        <option value="quarterly">Trimestral</option>
                    </select>
                </div>
                <div class="d-grid mt-4">
                    <button type="submit" class="btn btn-primary btn-lg py-3 fw-bold shadow-sm">
                        Confirmar Agendamento Geral
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
\n\n===== ./app/templates/members/ministry_materials.html =====
<!-- Materiais do Ministério -->
<div class="card border-0 shadow-sm mb-5">
    <div class="card-header bg-primary text-white">
        <h5 class="mb-0">Materiais do Ministério</h5>
    </div>
    <div class="card-body">
        {% if ministry.media_items %}
        <div class="list-group">
            {% for item in ministry.media_items %}
            <a href="{{ url_for('static', filename='uploads/media/' + item.file_path) }}" class="list-group-item list-group-item-action" target="_blank">
                <i class="bi bi-file-earmark me-2"></i> {{ item.title }}
                <small class="text-muted float-end">{{ item.created_at.strftime('%d/%m/%Y') }}</small>
            </a>
            {% endfor %}
        </div>
        {% else %}
        <p class="text-muted text-center py-3">Ainda não há materiais anexados.</p>
        {% endif %}
    </div>
    {% if current_user.id == ministry.leader_id or current_user.can_manage_ministries %}
    <div class="card-footer bg-light text-end">
        <a href="{{ url_for('edification.add_media', ministry_id=ministry.id) }}" class="btn btn-sm btn-success">
            <i class="bi bi-plus-circle me-1"></i> Adicionar Arquivo/Material
        </a>
    </div>
    {% endif %}
</div>
\n\n===== ./app/templates/members/ministry_materials_add.html =====
{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card border-0 shadow-sm p-4">
            <h3 class="fw-bold mb-4">Adicionar Material ao Ministério {{ ministry.name }}</h3>
            <p class="text-muted mb-4">Arquivos visíveis apenas para os membros deste ministério (hinos, imagens para colorir, etc.).</p>
            
            <form method="POST" enctype="multipart/form-data">
                <div class="mb-3">
                    <label class="form-label small fw-bold">TÍTULO DO ARQUIVO</label>
                    <input type="text" name="title" class="form-control bg-light border-0" required placeholder="Ex: Hinos do Ensaio - Fevereiro">
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">DESCRIÇÃO (opcional)</label>
                    <textarea name="description" class="form-control bg-light border-0" rows="3" placeholder="Detalhes do arquivo..."></textarea>
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">ARQUIVO (imagem, PDF, vídeo mp4)</label>
                    <input type="file" name="file" class="form-control bg-light border-0" accept="image/*,application/pdf,video/mp4" required>
                </div>
                <div class="d-grid mt-4">
                    <button type="submit" class="btn btn-primary btn-lg py-3 fw-bold shadow-sm">
                        <i class="bi bi-upload me-2"></i> Fazer Upload
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
\n\n===== ./app/templates/finance/dashboard.html =====
{% extends "base.html" %}
{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold">Gestão Financeira</h2>
        <div class="d-flex gap-2">
            {% if current_user.can_manage_finance or (current_user.church_role and current_user.church_role.name in ["Administrador Global", "Pastor Líder", "Tesoureiro"]) %}
            <a href="{{ url_for('finance.report') }}" class="btn btn-outline-primary">
                <i class="bi bi-file-earmark-bar-graph me-2"></i> Relatórios
            </a>
            <a href="{{ url_for('finance.add_transaction') }}" class="btn btn-primary">
                <i class="bi bi-plus-lg me-2"></i> Novo Lançamento
            </a>
            {% endif %}
        </div>
    </div>

    {% if stats %}
    <div class="row g-4 mb-5">
        <div class="col-md-4">
            <div class="card border-0 shadow-sm bg-success bg-opacity-10">
                <div class="card-body p-4">
                    <p class="text-success small fw-bold mb-1">TOTAL ENTRADAS</p>
                    <h3 class="fw-bold text-success mb-0">R$ {{ "%.2f"|format(stats.income) }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card border-0 shadow-sm bg-danger bg-opacity-10">
                <div class="card-body p-4">
                    <p class="text-danger small fw-bold mb-1">TOTAL SAÍDAS</p>
                    <h3 class="fw-bold text-danger mb-0">R$ {{ "%.2f"|format(stats.expense) }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card border-0 shadow-sm bg-primary bg-opacity-10">
                <div class="card-body p-4">
                    <p class="text-primary small fw-bold mb-1">SALDO ATUAL</p>
                    <h3 class="fw-bold text-primary mb-0">R$ {{ "%.2f"|format(stats.balance) }}</h3>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <div class="row g-4">
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-transparent border-0 p-4 pb-0">
                    <h5 class="fw-bold mb-0">Últimas Transações</h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="bg-light">
                                <tr>
                                    <th class="px-4 py-3">Data</th>
                                    <th class="py-3">Categoria</th>
                                    <th class="py-3 text-end">Valor</th>
                                    <th class="px-4 py-3 text-center">Recibo</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for tx in transactions %}
                                <tr>
                                    <td class="px-4">{{ tx.date.strftime('%d/%m/%Y') }}</td>
                                    <td>
                                        <span class="badge bg-{{ 'success' if tx.type == 'income' else 'danger' }} bg-opacity-10 text-{{ 'success' if tx.type == 'income' else 'danger' }} px-3 py-2">
                                            {{ tx.category.capitalize() }}
                                        </span>
                                        <div class="small text-muted mt-1">{{ tx.description or '-' }}</div>
                                    </td>
                                    <td class="text-end fw-bold {{ 'text-success' if tx.type == 'income' else 'text-danger' }}">
                                        {{ '+' if tx.type == 'income' else '-' }} R$ {{ "%.2f"|format(tx.amount) }}
                                    </td>
                                    <td class="px-4 text-center">
                                        {% if tx.user_id %}
                                        <a href="{{ url_for('finance.download_receipt', tx_id=tx.id) }}" class="btn btn-sm btn-outline-primary rounded-pill px-3">
                                            <i class="bi bi-download me-1"></i> PDF
                                        </a>
                                        {% else %}
                                        <span class="text-muted small">N/A</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% else %}
                                <tr>
                                    <td colspan="4" class="text-center py-5 text-muted">
                                        <i class="bi bi-inbox fs-1 d-block mb-2"></i>
                                        Nenhuma transação encontrada.
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-transparent border-0 p-4 pb-0 d-flex justify-content-between align-items-center">
                    <h5 class="fw-bold mb-0">Patrimônio</h5>
                    {% if current_user.can_manage_finance or (current_user.church_role and current_user.church_role.name in ["Administrador Global", "Tesoureiro"]) %}
                    <a href="{{ url_for('finance.add_asset') }}" class="btn btn-sm btn-primary">Novo</a>
                    {% endif %}
                </div>
                <div class="card-body p-4">
                    {% for asset in assets %}
                    <div class="d-flex justify-content-between align-items-center mb-3 pb-3 border-bottom">
                        <div>
                            <h6 class="fw-bold mb-0">{{ asset.name }}</h6>
                            <small class="text-muted">{{ asset.category }} | {{ asset.identifier or 'S/N' }}</small>
                        </div>
                        <div class="text-end">
                            <div class="fw-bold">R$ {{ "%.2f"|format(asset.value) }}</div>
                            <a href="{{ url_for('finance.add_maintenance', id=asset.id) }}" class="small text-primary text-decoration-none">Manutenção</a>
                        </div>
                    </div>
                    {% else %}
                    <p class="text-center text-muted py-4">Nenhum bem cadastrado.</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

\n\n===== ./app/templates/finance/add.html =====
{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card border-0 shadow-sm p-4">
            <h3 class="fw-bold mb-4">Novo Lançamento Financeiro</h3>
            <form method="POST">
                <div class="mb-3">
                    <label class="form-label small fw-bold">TIPO DE LANÇAMENTO</label>
                    <select name="type" id="tx_type" class="form-select bg-light border-0" required onchange="updateCategories()">
                        <option value="income">Entrada (Receita)</option>
                        <option value="expense">Saída (Despesa)</option>
                    </select>
                </div>
                
                <div class="mb-3">
                    <label class="form-label small fw-bold">CATEGORIA</label>
                    <select name="category" id="tx_category" class="form-select bg-light border-0" required onchange="toggleMemberSelect()">
                        <!-- Opções preenchidas via JS -->
                    </select>
                </div>

                <div class="mb-3" id="member_select_div">
                    <label class="form-label small fw-bold">MEMBRO (PARA DÍZIMOS NOMINAIS)</label>
                    <select name="user_id" class="form-select bg-light border-0">
                        <option value="">Selecione o membro...</option>
                        {% for member in members %}
                        <option value="{{ member.id }}">{{ member.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label small fw-bold">VALOR (R$)</label>
                    <input type="number" step="0.01" name="amount" class="form-control bg-light border-0" required placeholder="0,00">
                </div>

                <div class="mb-3">
                    <label class="form-label small fw-bold">DATA</label>
                    <input type="date" name="date" class="form-control bg-light border-0" value="{{ today }}">
                </div>

                <div class="mb-3">
                    <label class="form-label small fw-bold">DESCRIÇÃO / OBSERVAÇÃO</label>
                    <textarea name="description" class="form-control bg-light border-0" rows="2" placeholder="Detalhes adicionais..."></textarea>
                </div>

                <div class="d-grid mt-4">
                    <button type="submit" class="btn btn-primary btn-lg py-3 fw-bold shadow-sm">
                        Registrar Lançamento
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    const categories = {
        income: ['Dízimo', 'Oferta Alzira', 'Oferta de Culto', 'Oferta Especial', 'Doação', 'Outros'],
        expense: ['Luz', 'Água', 'Aluguel', 'Manutenção', 'Missões', 'Eventos', 'Salários', 'Outros']
    };

    function updateCategories() {
        const type = document.getElementById('tx_type').value;
        const categorySelect = document.getElementById('tx_category');
        categorySelect.innerHTML = '';
        
        categories[type].forEach(cat => {
            const option = document.createElement('option');
            option.value = cat;
            option.textContent = cat;
            categorySelect.appendChild(option);
        });
        toggleMemberSelect();
    }

    function toggleMemberSelect() {
        const category = document.getElementById('tx_category').value;
        const memberDiv = document.getElementById('member_select_div');
        if (category === 'Dízimo') {
            memberDiv.style.display = 'block';
        } else {
            memberDiv.style.display = 'none';
        }
    }

    // Inicializar
    updateCategories();
</script>
{% endblock %}

\n\n===== ./app/templates/finance/add_asset.html =====
{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card border-0 shadow-sm p-4">
            <h3 class="fw-bold mb-4">Cadastrar Bem (Patrimônio)</h3>
            <form method="POST">
                <div class="mb-3">
                    <label class="form-label small fw-bold">NOME DO BEM</label>
                    <input type="text" name="name" class="form-control bg-light border-0" placeholder="Ex: Microfone Shure, Veículo Fiat Toro" required>
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">CATEGORIA</label>
                    <select name="category" class="form-select bg-light border-0" required>
                        <option value="Equipamento">Equipamento</option>
                        <option value="Veículo">Veículo</option>
                        <option value="Móvel">Móvel</option>
                        <option value="Instrumento">Instrumento</option>
                        <option value="Outros">Outros</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">IDENTIFICADOR (PLACA/SERIAL)</label>
                    <input type="text" name="identifier" class="form-control bg-light border-0" placeholder="Ex: ABC-1234 ou SN: 987654">
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">VALOR ESTIMADO (R$)</label>
                    <input type="number" step="0.01" name="value" class="form-control bg-light border-0" required>
                </div>
                <div class="d-grid mt-4">
                    <button type="submit" class="btn btn-primary btn-lg py-3 fw-bold shadow-sm">
                        Salvar no Patrimônio
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

\n\n===== ./app/templates/finance/add_maintenance.html =====
{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card border-0 shadow-sm p-4">
            <h3 class="fw-bold mb-2">Registrar Manutenção</h3>
            <p class="text-muted mb-4">Bem: <strong>{{ asset.name }}</strong> ({{ asset.identifier }})</p>
            <form method="POST">
                <div class="mb-3">
                    <label class="form-label small fw-bold">TIPO DE CUSTO</label>
                    <select name="type" class="form-select bg-light border-0" required>
                        <option value="Reparo">Reparo / Conserto</option>
                        <option value="Combustível">Combustível</option>
                        <option value="Seguro">Seguro</option>
                        <option value="Limpeza">Limpeza</option>
                        <option value="Outros">Outros</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">VALOR DO CUSTO (R$)</label>
                    <input type="number" step="0.01" name="cost" class="form-control bg-light border-0" required>
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">DESCRIÇÃO DOS SERVIÇOS</label>
                    <textarea name="description" class="form-control bg-light border-0" rows="3" placeholder="Detalhe o que foi feito..." required></textarea>
                </div>
                <div class="d-grid mt-4">
                    <button type="submit" class="btn btn-primary btn-lg py-3 fw-bold shadow-sm">
                        Registrar e Lançar Despesa
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

\n\n===== ./app/templates/finance/report.html =====
{% extends "base.html" %}
{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold">Relatório Consolidado (30 dias)</h2>
        <button onclick="window.print()" class="btn btn-outline-primary d-print-none">
            <i class="bi bi-printer me-2"></i> Imprimir
        </button>
    </div>

    <div class="row g-4">
        <div class="col-md-6">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body p-4">
                    <h5 class="fw-bold mb-4 text-success">Entradas por Categoria</h5>
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Categoria</th>
                                    <th class="text-end">Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for cat, type, total in results if type == 'income' %}
                                <tr>
                                    <td>{{ cat.capitalize() }}</td>
                                    <td class="text-end fw-bold text-success">R$ {{ "%.2f"|format(total) }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body p-4">
                    <h5 class="fw-bold mb-4 text-danger">Saídas por Categoria</h5>
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Categoria</th>
                                    <th class="text-end">Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for cat, type, total in results if type == 'expense' %}
                                <tr>
                                    <td>{{ cat.capitalize() }}</td>
                                    <td class="text-end fw-bold text-danger">R$ {{ "%.2f"|format(total) }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

\n\n===== ./app/templates/edification/view_study.html =====
{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-9">
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('edification.list_studies') }}">Estudos</a></li>
                <li class="breadcrumb-item active" aria-current="page">{{ study.title }}</li>
            </ol>
        </nav>

        <div class="card border-0 shadow-sm p-4 p-md-5">
            <div class="mb-4">
                <span class="badge bg-primary bg-opacity-10 text-primary px-3 py-2 mb-3">{{ study.category }}</span>
                <h1 class="fw-bold display-5 mb-3">{{ study.title }}</h1>
                <div class="d-flex align-items-center text-muted">
                    <i class="bi bi-person-circle me-2"></i>
                    <span>Por <strong>{{ study.author.name }}</strong></span>
                    <span class="mx-2">•</span>
                    <i class="bi bi-calendar3 me-2"></i>
                    <span>{{ study.created_at.strftime('%d de %B, %Y') }}</span>
                </div>
            </div>
            
            <hr class="my-4 opacity-25">
            
            <div class="study-content">
                {{ content_html|safe }}
            </div>
            
            <div class="mt-5 pt-4 border-top opacity-75">
                <p class="text-muted small">Este estudo foi publicado para a edificação do corpo de Cristo. Que a Palavra de Deus produza frutos em seu coração.</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

\n\n===== ./app/templates/edification/kids.html =====
{% extends "base.html" %}
{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-5">
        <div>
            <h1 class="fw-bold text-warning"><i class="bi bi-balloon-heart-fill me-2"></i>Ecclesia Kids</h1>
            <p class="text-muted">Espaço especial para nossas crianças crescerem na Palavra!</p>
        </div>
        {% if current_user.can_manage_kids or (current_user.church_role and current_user.church_role.name in ['Administrador Global', 'Pastor Líder']) %}
        <a href="{{ url_for('edification.add_kids_activity') }}" class="btn btn-warning fw-bold">
            <i class="bi bi-plus-lg me-2"></i> Nova Atividade
        </a>
        {% endif %}
    </div>

    <div class="row g-4">
        {% for act in activities %}
        <div class="col-md-6 col-lg-4">
            <div class="card h-100 border-0 shadow-sm overflow-hidden" style="border-top: 5px solid #ffc107 !important;">
                <div class="bg-warning bg-opacity-10 py-2 px-3 text-warning small fw-bold">
                    {{ act.age_group }}
                </div>
                <div class="card-body p-4">
                    <h5 class="fw-bold mb-3">{{ act.title }}</h5>
                    <p class="text-muted small mb-4">{{ act.content|truncate(150) }}</p>
                    <div class="d-flex justify-content-between align-items-center">
                        <small class="text-muted">{{ act.created_at.strftime('%d/%m/%Y') }}</small>
                        <button class="btn btn-sm btn-outline-warning rounded-pill px-3">Ver Atividade</button>
                    </div>
                </div>
            </div>
        </div>
        {% else %}
        <div class="col-12 text-center py-5">
            <i class="bi bi-emoji-smile fs-1 text-warning opacity-50 d-block mb-3"></i>
            <p class="text-muted">Em breve teremos muitas atividades legais aqui!</p>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}

\n\n===== ./app/templates/edification/add_kids.html =====
{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card border-0 shadow-sm p-4">
            <h3 class="fw-bold mb-4 text-warning"><i class="bi bi-balloon me-2"></i>Nova Atividade Kids</h3>
            <form method="POST">
                <div class="mb-3">
                    <label class="form-label small fw-bold">TÍTULO DA ATIVIDADE</label>
                    <input type="text" name="title" class="form-control bg-light border-0" placeholder="Ex: A Arca de Noé - Colorir" required>
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">FAIXA ETÁRIA</label>
                    <select name="age_group" class="form-select bg-light border-0" required>
                        <option value="0-3 anos">Berçário (0-3 anos)</option>
                        <option value="4-6 anos">Maternal (4-6 anos)</option>
                        <option value="7-10 anos">Primários (7-10 anos)</option>
                        <option value="11+ anos">Juniores (11+ anos)</option>
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">CONTEÚDO / INSTRUÇÕES</label>
                    <textarea name="content" class="form-control bg-light border-0" rows="5" placeholder="Descreva a atividade ou cole o link do material..." required></textarea>
                </div>
                <div class="d-grid mt-4">
                    <button type="submit" class="btn btn-warning btn-lg py-3 fw-bold shadow-sm text-white">
                        Publicar no Espaço Kids
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

\n\n===== ./app/templates/edification/studies.html =====
{% extends "base.html" %}
{% block content %}
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-5">
        <div>
            <h1 class="fw-bold text-primary"><i class="bi bi-book-half me-2"></i>Centro de Estudos</h1>
            <p class="text-muted">Cresça no conhecimento da Palavra de Deus.</p>
        </div>
        {% if current_user.can_publish_devotionals or (current_user.church_role and current_user.church_role.name in ['Administrador Global', 'Pastor Líder']) %}
        <a href="{{ url_for('edification.add_study') }}" class="btn btn-primary fw-bold">
            <i class="bi bi-plus-lg me-2"></i> Novo Estudo
        </a>
        {% endif %}
    </div>

    <div class="row g-4">
        {% for study in studies %}
        <div class="col-md-6 col-lg-4">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-body p-4">
                    <h5 class="fw-bold mb-3">{{ study.title }}</h5>
                    <p class="text-muted small mb-4">{{ study.content[:150] }}...</p>
                    <div class="d-flex justify-content-between align-items-center">
                        <small class="text-muted">{{ study.created_at.strftime('%d/%m/%Y') }}</small>
                        <a href="{{ url_for('edification.view_study', id=study.id) }}" class="btn btn-sm btn-outline-primary rounded-pill px-3">Ler Estudo</a>
                    </div>
                </div>
            </div>
        </div>
        {% else %}
        <div class="col-12 text-center py-5">
            <i class="bi bi-journal-text fs-1 text-muted opacity-50 d-block mb-3"></i>
            <p class="text-muted">Nenhum estudo bíblico disponível no momento.</p>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}

\n\n===== ./app/templates/edification/add_study.html =====
{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card border-0 shadow-sm p-4">
            <h3 class="fw-bold mb-4">Novo Estudo Bíblico</h3>
            <form method="POST">
                <div class="mb-3">
                    <label class="form-label small fw-bold">TÍTULO DO ESTUDO</label>
                    <input type="text" name="title" class="form-control bg-light border-0" placeholder="Ex: A Importância da Oração" required>
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">CATEGORIA</label>
                    <input type="text" name="category" class="form-control bg-light border-0" placeholder="Ex: Doutrina, Família, Escatologia" required>
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">CONTEÚDO (SUPORTA MARKDOWN)</label>
                    <textarea name="content" class="form-control bg-light border-0" rows="12" placeholder="Escreva o estudo aqui..." required></textarea>
                    <div class="form-text small">Você pode usar negrito (**texto**), listas (- item) e títulos (# Título).</div>
                </div>
                <div class="d-grid mt-4">
                    <button type="submit" class="btn btn-primary btn-lg py-3 fw-bold shadow-sm">
                        Publicar Estudo
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

\n\n===== ./app/templates/edification/gallery.html =====
{% extends "base.html" %}
{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-5">
        <div>
            <h1 class="fw-bold text-primary"><i class="bi bi-images me-2"></i>Galeria de Mídia</h1>
            <p class="text-muted">Memórias e registros dos nossos eventos e cultos.</p>
        </div>
        {% if current_user.can_manage_media or (current_user.church_role and current_user.church_role.name in ["Administrador Global", "Pastor Líder"]) or any(m.leader_id == current_user.id for m in current_user.ministries) %}
        <a href="{{ url_for('edification.add_media') }}" class="btn btn-primary fw-bold">
            <i class="bi bi-upload me-2"></i> Nova Mídia
        </a>
        {% endif %}
    </div>

    <!-- Filtros -->
    <div class="mb-4 d-flex gap-2 overflow-auto pb-2">
        <a href="{{ url_for('edification.gallery') }}" class="btn btn-sm {{ 'btn-primary' if not request.args.get('ministry_id') else 'btn-outline-primary' }} rounded-pill px-3">Tudo</a>
        {% for min in ministries %}
        <a href="{{ url_for('edification.gallery', ministry_id=min.id) }}" class="btn btn-sm {{ 'btn-primary' if request.args.get('ministry_id')|int == min.id else 'btn-outline-primary' }} rounded-pill px-3">
            {{ min.name }}
        </a>
        {% endfor %}
    </div>

    <div class="row g-4">
        {% for item in media_items %}
        <div class="col-md-6 col-lg-4">
            <div class="card h-100 border-0 shadow-sm overflow-hidden">
                {% if item.media_type == 'image' %}
                <img src="{{ url_for('static', filename='uploads/media/' + item.file_path) }}" class="card-img-top" alt="{{ item.title }}" style="height: 220px; object-fit: cover;">
                {% elif item.media_type == 'video' %}
                <div class="bg-dark d-flex align-items-center justify-content-center position-relative" style="height: 220px;">
                    <video width="100%" height="100%" style="object-fit: cover;" controls>
                        <source src="{{ url_for('static', filename='uploads/media/' + item.file_path) }}" type="video/mp4">
                    </video>
                </div>
                {% elif item.media_type == 'pdf' %}
                <div class="bg-light d-flex align-items-center justify-content-center" style="height: 220px;">
                    <i class="bi bi-file-earmark-pdf text-danger display-1"></i>
                </div>
                {% endif %}
                
                <div class="card-body p-4">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <span class="badge bg-primary bg-opacity-10 text-primary">{{ item.ministry.name if item.ministry else 'Geral' }}</span>
                        <small class="text-muted">{{ item.created_at.strftime('%d/%m/%Y') }}</small>
                    </div>
                    <h5 class="fw-bold mb-2">{{ item.title }}</h5>
                    <p class="text-muted small mb-3">{{ item.description or '' }}</p>
                    
                    <div class="d-grid">
                        <a href="{{ url_for('static', filename='uploads/media/' + item.file_path) }}" target="_blank" class="btn btn-sm btn-outline-primary">
                            <i class="bi bi-eye me-1"></i> Visualizar
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% else %}
        <div class="col-12 text-center py-5">
            <i class="bi bi-camera fs-1 text-muted opacity-50 d-block mb-3"></i>
            <p class="text-muted">Nenhuma mídia encontrada nesta categoria.</p>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}

\n\n===== ./app/templates/edification/add_media.html =====
{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card border-0 shadow-sm p-4">
            <h3 class="fw-bold mb-4">Adicionar Mídia</h3>
            <form method="POST" enctype="multipart/form-data">
                <div class="mb-3">
                    <label class="form-label small fw-bold">TÍTULO</label>
                    <input type="text" name="title" class="form-control bg-light border-0" required placeholder="Ex: Hinos do Ensaio - Fevereiro">
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">EVENTO / DATA</label>
                    <input type="text" name="event_name" class="form-control bg-light border-0" placeholder="Ex: Culto de Jovens - 08/02">
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">MINISTÉRIO (OPCIONAL)</label>
                    <select name="ministry_id" class="form-select bg-light border-0">
                        <option value="">Geral / Igreja</option>
                        {% for min in ministries %}
                        <option value="{{ min.id }}">{{ min.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">ARQUIVO (imagem, PDF, vídeo mp4)</label>
                    <input type="file" name="file" class="form-control bg-light border-0" accept="image/*,application/pdf,video/mp4" required>
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">DESCRIÇÃO (opcional)</label>
                    <textarea name="description" class="form-control bg-light border-0" rows="3" placeholder="Detalhes do arquivo..."></textarea>
                </div>
                <div class="d-grid mt-4">
                    <button type="submit" class="btn btn-primary btn-lg py-3 fw-bold shadow-sm">
                        <i class="bi bi-upload me-2"></i> Fazer Upload
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

\n\n===== ./app/templates/edification/add_devotional.html =====
{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card border-0 shadow-sm p-4">
            <h3 class="fw-bold mb-4">Adicionar Devocional</h3>
            <form method="POST">
                <div class="mb-3">
                    <label class="form-label small fw-bold">DATA</label>
                    <input type="date" name="date" class="form-control bg-light border-0" required>
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">TÍTULO</label>
                    <input type="text" name="title" class="form-control bg-light border-0" required>
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">VERSÍCULO</label>
                    <input type="text" name="verse" class="form-control bg-light border-0" required>
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">CONTEÚDO</label>
                    <textarea name="content" class="form-control bg-light border-0" rows="10" required></textarea>
                </div>
                <div class="d-grid mt-4">
                    <button type="submit" class="btn btn-primary btn-lg py-3 fw-bold shadow-sm">
                        Criar Devocional
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
\n\n===== ./app/templates/edification/edit_devotional.html =====
{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card border-0 shadow-sm p-4">
            <h3 class="fw-bold mb-4">Editar Devocional de {{ devotional.date.strftime('%d/%m/%Y') }}</h3>
            <form method="POST">
                <div class="mb-3">
                    <label class="form-label small fw-bold">TÍTULO</label>
                    <input type="text" name="title" class="form-control bg-light border-0" value="{{ devotional.title }}" required>
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">VERSÍCULO</label>
                    <input type="text" name="verse" class="form-control bg-light border-0" value="{{ devotional.verse }}" required>
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">CONTEÚDO</label>
                    <textarea name="content" class="form-control bg-light border-0" rows="10" required>{{ devotional.content }}</textarea>
                </div>
                <div class="d-grid mt-4">
                    <button type="submit" class="btn btn-primary btn-lg py-3 fw-bold shadow-sm">
                        Salvar Alterações
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
\n\n===== ./app/templates/edification/list_devotionals.html =====
{% extends "base.html" %}
{% block content %}
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-5">
        <div>
            <h1 class="fw-bold text-primary"><i class="bi bi-book-half me-2"></i> Gerenciar Devocionais</h1>
            <p class="text-muted">Todos os devocionais cadastrados. Edite ou exclua quando necessário.</p>
        </div>
        <a href="{{ url_for('edification.add_devotional') }}" class="btn btn-primary fw-bold">
            <i class="bi bi-plus-lg me-2"></i> Novo Devocional
        </a>
    </div>

    {% if devotionals %}
    <div class="table-responsive">
        <table class="table table-hover align-middle">
            <thead class="table-light">
                <tr>
                    <th>Data</th>
                    <th>Título</th>
                    <th>Versículo</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                {% for dev in devotionals %}
                <tr>
                    <td>{{ dev.date.strftime('%d/%m/%Y') }}</td>
                    <td>{{ dev.title or 'Sem título' }}</td>
                    <td><em>{{ dev.verse or '-' }}</em></td>
                    <td>
                        <a href="{{ url_for('edification.edit_devotional', id=dev.id) }}" class="btn btn-sm btn-outline-info">
                            <i class="bi bi-pencil"></i> Editar
                        </a>
                        <a href="{{ url_for('edification.delete_devotional', id=dev.id) }}" class="btn btn-sm btn-outline-danger" onclick="return confirm('Tem certeza que deseja excluir este devocional?');">
                            <i class="bi bi-trash"></i> Excluir
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="alert alert-info text-center py-5">
        <i class="bi bi-journal-text fs-1 d-block mb-3"></i>
        <p class="mb-0">Nenhum devocional cadastrado ainda.</p>
    </div>
    {% endif %}
</div>
{% endblock %}
\n\n===== ./app/templates/auth/login.html =====
{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center align-items-center min-vh-100">
    <div class="col-md-5 col-lg-4">
        <div class="text-center mb-5">
            <div class="d-inline-flex align-items-center justify-content-center bg-primary bg-opacity-10 rounded-circle p-3 mb-3">
                <i class="bi bi-lightning-charge-fill text-primary fs-1"></i>
            </div>
            <h2 class="fw-bold">Ecclesia Master</h2>
            <p class="text-muted">Gestão Eclesiástica de Alta Performance</p>
        </div>

        <div class="card border-0 shadow-lg p-4">
            <div class="card-body">
                <h4 class="fw-bold mb-4">Acesse sua conta</h4>
                <form method="POST">
                    <div class="mb-3">
                        <label class="form-label small fw-bold text-muted">E-MAIL</label>
                        <div class="input-group">
                            <span class="input-group-text bg-light border-0"><i class="bi bi-envelope"></i></span>
                            <input type="email" name="email" class="form-control bg-light border-0" placeholder="seu@email.com" required>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="form-label small fw-bold text-muted">SENHA</label>
                        <div class="input-group">
                            <span class="input-group-text bg-light border-0"><i class="bi bi-lock"></i></span>
                            <input type="password" name="password" class="form-control bg-light border-0" placeholder="Sua senha" required>
                        </div>
                    </div>
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary btn-lg py-3 fw-bold shadow-sm">
                            Entrar no Sistema
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <div class="text-center mt-4">
            <p class="text-muted small">© 2026 Ecclesia Master. Todos os direitos reservados.</p>
        </div>
    </div>
</div>
{% endblock %}

\n\n===== ./app/templates/auth/register.html =====
{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center py-5">
    <div class="col-md-8 col-lg-6">
        <div class="card border-0 shadow-lg p-4">
            <div class="card-body">
                <h3 class="fw-bold mb-4 text-center">Solicitar Cadastro</h3>
                <form method="POST">
                    <div class="row g-3">
                        <div class="col-12">
                            <label class="form-label small fw-bold">NOME COMPLETO</label>
                            <input type="text" name="name" class="form-control bg-light border-0" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label small fw-bold">E-MAIL</label>
                            <input type="email" name="email" class="form-control bg-light border-0" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label small fw-bold">SENHA</label>
                            <input type="password" name="password" class="form-control bg-light border-0" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label small fw-bold">DATA DE NASCIMENTO</label>
                            <input type="date" name="birth_date" class="form-control bg-light border-0" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label small fw-bold">SEXO</label>
                            <select name="gender" class="form-select bg-light border-0" required>
                                <option value="Masculino">Masculino</option>
                                <option value="Feminino">Feminino</option>
                                <option value="Outro">Outro</option>
                            </select>
                        </div>
                        <div class="col-12">
                            <label class="form-label small fw-bold">CONGREGAÇÃO (FILIAL)</label>
                            <select name="church_id" class="form-select bg-light border-0" required>
                                {% for church in churches %}
                                <option value="{{ church.id }}">{{ church.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-12">
                            <label class="form-label small fw-bold">DOCUMENTOS (RG/CPF/PASSAPORTE)</label>
                            <input type="text" name="documents" class="form-control bg-light border-0" placeholder="Informe seus documentos principais" required>
                        </div>
                        <div class="col-12">
                            <label class="form-label small fw-bold">ENDEREÇO COMPLETO</label>
                            <textarea name="address" class="form-control bg-light border-0" rows="2" required></textarea>
                        </div>
                        <div class="col-12">
                            <label class="form-label small fw-bold">TELEFONE / CONTATO</label>
                            <input type="text" name="phone" class="form-control bg-light border-0" required>
                        </div>
                    </div>
                    <div class="d-grid mt-4">
                        <button type="submit" class="btn btn-primary btn-lg py-3 fw-bold shadow-sm">
                            Enviar Solicitação
                        </button>
                    </div>
                    <div class="text-center mt-3">
                        <a href="{{ url_for('auth.login') }}" class="text-decoration-none small">Já tem conta? Faça login</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

\n\n===== ./app/templates/auth/change_password.html =====
{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-md-5">
        <div class="card border-0 shadow-sm p-4">
            <h3 class="fw-bold mb-4"><i class="bi bi-shield-lock me-2 text-primary"></i>Alterar Senha</h3>
            <form method="POST">
                <div class="mb-3">
                    <label class="form-label small fw-bold">SENHA ATUAL</label>
                    <input type="password" name="old_password" class="form-control bg-light border-0" required>
                </div>
                <hr class="my-4 opacity-25">
                <div class="mb-3">
                    <label class="form-label small fw-bold">NOVA SENHA</label>
                    <input type="password" name="new_password" class="form-control bg-light border-0" required>
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">CONFIRMAR NOVA SENHA</label>
                    <input type="password" name="confirm_password" class="form-control bg-light border-0" required>
                </div>
                <div class="d-grid mt-4">
                    <button type="submit" class="btn btn-primary btn-lg py-3 fw-bold shadow-sm">
                        Atualizar Senha
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

\n\n===== ./app/templates/index.html =====
{% extends "base.html" %}
{% block content %}
<div class="row align-items-center min-vh-75">
    <div class="col-lg-6">
        <span class="badge bg-primary bg-opacity-10 text-primary px-3 py-2 mb-3 fw-bold">Gestão Eclesiástica 2026</span>
        <h1 class="display-3 fw-bold mb-4">Ecclesia <span class="text-primary">Master</span></h1>
        <p class="lead text-muted mb-5">Uma plataforma completa e moderna para a gestão da sua igreja, congregações e ministérios. Focada em edificação, transparência e comunhão.</p>
        
        {% if not current_user.is_authenticated %}
        <p class="text-muted mb-3 fw-bold">Novo aqui? Solicite seu cadastro ou faça login para acessar o painel.</p>
        {% endif %}
        
        <div class="d-flex gap-3">
            {% if not current_user.is_authenticated %}
            <a href="{{ url_for('auth.login') }}" class="btn btn-primary btn-lg px-5 py-3 fw-bold shadow">Entrar no Sistema</a>
            <a href="{{ url_for('auth.register') }}" class="btn btn-outline-primary btn-lg px-5 py-3 fw-bold">Solicitar Cadastro</a>
            {% else %}
            <a href="{{ url_for('members.dashboard') }}" class="btn btn-primary btn-lg px-5 py-3 fw-bold shadow">Ir para o Painel</a>
            {% endif %}
        </div>
    </div>
    <div class="col-lg-6 d-none d-lg-block">
        <div class="position-relative">
            <div class="bg-primary bg-opacity-10 rounded-4 p-5">
                <i class="bi bi-lightning-charge-fill text-primary display-1"></i>
                <div class="mt-4">
                    <h4 class="fw-bold">Multi-Congregação</h4>
                    <p class="text-muted">Gerencie todas as suas filiais em um único lugar com relatórios consolidados.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Nova seção: Eventos Públicos (cultos padrões, sem login) -->
<div class="row justify-content-center mb-5">
    <div class="col-lg-8">
        <div class="card border-0 shadow-sm p-4">
            <h4 class="fw-bold mb-4"><i class="bi bi-calendar-event me-2 text-primary"></i>Próximos Eventos e Cultos</h4>
            <div class="list-group list-group-flush">
                {% for event in public_events %}
                <div class="list-group-item px-0 py-3 border-0 border-bottom">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="fw-bold mb-1">{{ event.title }}</h6>
                            <small class="text-muted">
                                <i class="bi bi-clock me-1"></i> {{ event.start_time.strftime('%d/%m %H:%M') }}
                                {% if event.recurrence != 'none' %}
                                <span class="badge bg-warning bg-opacity-10 text-warning ms-2">{{ event.recurrence|capitalize }}</span>
                                {% endif %}
                                <span class="badge bg-secondary bg-opacity-10 text-secondary ms-2">Geral</span>
                            </small>
                        </div>
                        <div class="text-end">
                            <small class="d-block text-muted"><i class="bi bi-geo-alt"></i> {{ event.location }}</small>
                        </div>
                    </div>
                </div>
                {% else %}
                <p class="text-muted">Nenhum evento público agendado no momento.</p>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<!-- Galeria Pública - Visível sem login -->
<div class="row justify-content-center mb-5">
    <div class="col-lg-10">
        <div class="card border-0 shadow-sm p-4">
            <h4 class="fw-bold mb-4 text-center"><i class="bi bi-images me-2 text-primary"></i>Galeria da Igreja</h4>
            <div class="row g-3">
                {% for item in recent_media %}
                <div class="col-md-4 col-lg-3">
                    {% if item.media_type == 'image' %}
                    <img src="{{ url_for('static', filename='uploads/media/' + item.file_path) }}" class="img-fluid rounded shadow-sm" alt="{{ item.title }}" style="height: 180px; object-fit: cover; width: 100%;">
                    {% else %}
                    <video controls class="img-fluid rounded shadow-sm" style="height: 180px; object-fit: cover; width: 100%;">
                        <source src="{{ url_for('static', filename='uploads/media/' + item.file_path) }}" type="video/mp4">
                    </video>
                    {% endif %}
                    <p class="small text-center mt-2 fw-bold">{{ item.title }}</p>
                </div>
                {% else %}
                <p class="text-center text-muted">Ainda não há mídias públicas disponíveis.</p>
                {% endfor %}
            </div>
            <div class="text-center mt-4">
                <a href="{{ url_for('auth.register') }}" class="btn btn-outline-primary">
                    <i class="bi bi-person-plus me-1"></i> Solicite seu cadastro para ver a galeria completa
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}
\n\n===== ./app/templates/admin/churches.html =====
{% extends "base.html" %}
{% block content %}
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-5">
        <div>
            <h1 class="fw-bold text-primary"><i class="bi bi-building-fill me-2"></i>Congregações</h1>
            <p class="text-muted">Gerencie a sede e as filiais da igreja.</p>
        </div>
        <a href="{{ url_for('admin.add_church') }}" class="btn btn-primary fw-bold">
            <i class="bi bi-plus-lg me-2"></i> Nova Congregação
        </a>
    </div>

    <div class="row g-4">
        {% for church in churches %}
        <div class="col-md-6">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-body p-4">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <h5 class="fw-bold mb-0">{{ church.name }}</h5>
                        {% if church.is_main %}
                        <span class="badge bg-primary">Sede</span>
                        {% else %}
                        <span class="badge bg-secondary">Filial</span>
                        {% endif %}
                    </div>
                    <p class="text-muted small mb-2"><i class="bi bi-geo-alt me-2"></i>{{ church.address }}</p>
                    <p class="text-muted small mb-4"><i class="bi bi-globe me-2"></i>{{ church.city }}, {{ church.country }}</p>
                    
                    <div class="d-flex gap-2">
                        <a href="{{ url_for('admin.edit_church', id=church.id) }}" class="btn btn-sm btn-outline-primary">Editar</a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}

\n\n===== ./app/templates/admin/add_church.html =====
{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card border-0 shadow-sm p-4">
            <h3 class="fw-bold mb-4">Nova Congregação</h3>
            <form method="POST">
                <div class="mb-3">
                    <label class="form-label small fw-bold">NOME DA CONGREGAÇÃO</label>
                    <input type="text" name="name" class="form-control bg-light border-0" placeholder="Ex: AD Jesus para as Nações - Filial Sul" required>
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">ENDEREÇO</label>
                    <input type="text" name="address" class="form-control bg-light border-0" required>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label small fw-bold">CIDADE</label>
                        <input type="text" name="city" class="form-control bg-light border-0" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label small fw-bold">PAÍS</label>
                        <input type="text" name="country" class="form-control bg-light border-0" required>
                    </div>
                </div>
                <div class="mb-3 form-check">
                    <input type="checkbox" name="is_main" class="form-check-input" id="isMain">
                    <label class="form-check-label" for="isMain">Esta é a sede principal?</label>
                </div>
                <div class="d-grid mt-4">
                    <button type="submit" class="btn btn-primary btn-lg py-3 fw-bold shadow-sm">
                        Cadastrar Congregação
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

\n\n===== ./app/templates/admin/members.html =====
{% extends "base.html" %}
{% block content %}
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-5">
        <div>
            <h1 class="fw-bold text-primary"><i class="bi bi-people-fill me-2"></i>Gestão Global de Membros</h1>
            <p class="text-muted">Visualize e gerencie todos os membros de todas as congregações.</p>
        </div>
    </div>

    <div class="card border-0 shadow-sm">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="bg-light">
                    <tr>
                        <th class="ps-4">Nome</th>
                        <th>E-mail</th>
                        <th>Congregação</th>
                        <th>Cargo</th>
                        <th>Status</th>
                        <th class="text-end pe-4">Ações</th>
                    </tr>
                </thead>
                <tbody>
                    {% for member in members %}
                    <tr>
                        <td class="ps-4 fw-bold">{{ member.name }}</td>
                        <td>{{ member.email }}</td>
                        <td>{{ member.church.name if member.church else 'N/A' }}</td>
                        <td><span class="badge bg-info bg-opacity-10 text-info">{{ member.church_role.name if member.church_role else 'Sem cargo' }}</span></td>
                        <td>
                            {% if member.status == 'active' %}
                            <span class="badge bg-success">Ativo</span>
                            {% elif member.status == 'pending' %}
                            <span class="badge bg-warning">Pendente</span>
                            {% else %}
                            <span class="badge bg-danger">Inativo</span>
                            {% endif %}
                        </td>
                        <td class="text-end pe-4">
                            <a href="{{ url_for('admin.edit_member', id=member.id) }}" class="btn btn-sm btn-outline-primary">Editar</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
\n\n===== ./app/templates/admin/edit_member.html =====
{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card border-0 shadow-sm p-4">
            <h3 class="fw-bold mb-4">Editar Membro</h3>
            <form method="POST">
                <div class="mb-3">
                    <label class="form-label small fw-bold">NOME COMPLETO</label>
                    <input type="text" name="name" class="form-control bg-light border-0" value="{{ member.name }}" required>
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">E-MAIL</label>
                    <input type="email" name="email" class="form-control bg-light border-0" value="{{ member.email }}" required>
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">CONGREGAÇÃO</label>
                    <select name="church_id" class="form-select bg-light border-0">
                        {% for church in churches %}
                        <option value="{{ church.id }}" {{ 'selected' if member.church_id == church.id }}>{{ church.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">CARGO</label>
                    <select name="church_role_id" class="form-select bg-light border-0">
                        <option value="">Sem cargo</option>
                        {% for role in roles %}
                        <option value="{{ role.id }}" {{ 'selected' if member.church_role_id == role.id }}>{{ role.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">STATUS</label>
                    <select name="status" class="form-select bg-light border-0">
                        <option value="active" {{ 'selected' if member.status == 'active' }}>Ativo</option>
                        <option value="pending" {{ 'selected' if member.status == 'pending' }}>Pendente</option>
                        <option value="rejected" {{ 'selected' if member.status == 'rejected' }}>Rejeitado</option>
                    </select>
                </div>
                <div class="d-grid mt-4">
                    <button type="submit" class="btn btn-primary btn-lg py-3 fw-bold shadow-sm">
                        Salvar Alterações
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
\n\n===== ./app/templates/admin/list_roles.html =====
{% extends "base.html" %}
{% block content %}
<div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-5">
        <div>
            <h1 class="fw-bold text-primary"><i class="bi bi-person-badge-fill me-2"></i>Cargos da Congregação</h1>
            <p class="text-muted">Gerencie os cargos disponíveis para membros da sua congregação.</p>
        </div>
        <a href="{{ url_for('admin.add_role') }}" class="btn btn-primary fw-bold">
            <i class="bi bi-plus-lg me-2"></i> Novo Cargo
        </a>
    </div>

    <div class="card border-0 shadow-sm">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="bg-light">
                    <tr>
                        <th class="ps-4">Nome do Cargo</th>
                        <th>Descrição</th>
                        <th>Ordem</th>
                        <th class="text-end pe-4">Ações</th>
                    </tr>
                </thead>
                <tbody>
                    {% for role in roles %}
                    <tr>
                        <td class="ps-4 fw-bold">{{ role.name }}</td>
                        <td>{{ role.description or 'Sem descrição' }}</td>
                        <td>{{ role.order }}</td>
                        <td class="text-end pe-4">
                            <a href="{{ url_for('admin.edit_role', id=role.id) }}" class="btn btn-sm btn-outline-primary me-2">Editar</a>
                            <a href="{{ url_for('admin.delete_role', id=role.id) }}" class="btn btn-sm btn-outline-danger" onclick="return confirm('Tem certeza que deseja excluir este cargo?');">Excluir</a>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="4" class="text-center py-5 text-muted">
                            <i class="bi bi-person-badge fs-1 d-block mb-2"></i>
                            Nenhum cargo cadastrado para esta congregação.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
\n\n===== ./app/templates/admin/add_role.html =====
{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card border-0 shadow-sm p-4">
            <h3 class="fw-bold mb-4">Novo Cargo</h3>
            <form method="POST">
                <div class="mb-3">
                    <label class="form-label small fw-bold">NOME DO CARGO</label>
                    <input type="text" name="name" class="form-control bg-light border-0" placeholder="Ex: Diácono, Presbítero, Missionário" required>
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">DESCRIÇÃO</label>
                    <textarea name="description" class="form-control bg-light border-0" rows="3" placeholder="Descreva as responsabilidades..."></textarea>
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">ORDEM DE EXIBIÇÃO</label>
                    <input type="number" name="order" class="form-control bg-light border-0" value="0" min="0" placeholder="Número para ordenar na lista (menor primeiro)">
                </div>
                <div class="d-grid mt-4">
                    <button type="submit" class="btn btn-primary btn-lg py-3 fw-bold shadow-sm">
                        Cadastrar Cargo
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
\n\n===== ./app/templates/admin/edit_role.html =====
{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card border-0 shadow-sm p-4">
            <h3 class="fw-bold mb-4">Editar Cargo</h3>
            <form method="POST">
                <div class="mb-3">
                    <label class="form-label small fw-bold">NOME DO CARGO</label>
                    <input type="text" name="name" class="form-control bg-light border-0" value="{{ role.name }}" required>
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">DESCRIÇÃO</label>
                    <textarea name="description" class="form-control bg-light border-0" rows="3">{{ role.description }}</textarea>
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">ORDEM DE EXIBIÇÃO</label>
                    <input type="number" name="order" class="form-control bg-light border-0" value="{{ role.order }}" min="0">
                </div>
                <div class="form-check mb-3">
                    <input type="checkbox" name="is_active" class="form-check-input" id="isActive" {{ 'checked' if role.is_active }}>
                    <label class="form-check-label" for="isActive">Cargo ativo?</label>
                </div>
                <div class="d-grid mt-4">
                    <button type="submit" class="btn btn-primary btn-lg py-3 fw-bold shadow-sm">
                        Salvar Alterações
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
\n\n===== ./app/templates/admin/edit_church.html =====
{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card border-0 shadow-sm p-4">
            <h3 class="fw-bold mb-4">Editar Congregação</h3>
            <form method="POST">
                <div class="mb-3">
                    <label class="form-label small fw-bold">NOME DA CONGREGAÇÃO</label>
                    <input type="text" name="name" class="form-control bg-light border-0" value="{{ church.name }}" required>
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">ENDEREÇO</label>
                    <input type="text" name="address" class="form-control bg-light border-0" value="{{ church.address or '' }}" >
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">CIDADE</label>
                    <input type="text" name="city" class="form-control bg-light border-0" value="{{ church.city or '' }}">
                </div>
                <div class="mb-3">
                    <label class="form-label small fw-bold">PAÍS</label>
                    <input type="text" name="country" class="form-control bg-light border-0" value="{{ church.country or '' }}">
                </div>
                <div class="form-check mb-3">
                    <input type="checkbox" name="is_main" class="form-check-input" id="is_main" {{ 'checked' if church.is_main }}>
                    <label class="form-check-label" for="is_main">É a congregação principal (sede)</label>
                </div>
                <div class="d-grid mt-4">
                    <button type="submit" class="btn btn-primary btn-lg py-3 fw-bold shadow-sm">
                        Salvar Alterações
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
\n\n===== ./app/utils/pdf_gen.py =====
from fpdf import FPDF
import os
from flask import current_app

class ReceiptPDF(FPDF):
    def header(self):
        self.set_font('Arial', 'B', 15)
        self.cell(0, 10, 'RECIBO DE CONTRIBUIÇÃO', 0, 1, 'C')
        self.ln(5)

    def footer(self):
        self.set_y(-15)
        self.set_font('Arial', 'I', 8)
        self.cell(0, 10, f'Página {self.page_no()}', 0, 0, 'C')

def generate_receipt(transaction):
    pdf = ReceiptPDF()
    pdf.add_page()
    pdf.set_font('Arial', '', 12)
    
    # Church Info
    church_name = transaction.church.name if transaction.church else "Igreja Não Identificada"
    church_address = transaction.church.address if transaction.church else "Endereço Não Disponível"
    
    pdf.set_font('Arial', 'B', 12)
    pdf.cell(0, 10, f'Igreja: {church_name}', 0, 1)
    pdf.set_font('Arial', '', 12)
    pdf.cell(0, 10, f'Endereço: {church_address}', 0, 1)
    pdf.ln(10)
    
    # Transaction Info
    user_name = transaction.user.name if transaction.user else "Doador Anônimo"
    
    pdf.cell(0, 10, f'Recebemos de: {user_name}', 0, 1)
    pdf.cell(0, 10, f'A quantia de: R$ {transaction.amount:.2f}', 0, 1)
    pdf.cell(0, 10, f'Referente a: {transaction.category.capitalize()}', 0, 1)
    pdf.cell(0, 10, f'Data: {transaction.date.strftime("%d/%m/%Y")}', 0, 1)
    pdf.ln(20)
    
    # Signature
    pdf.line(10, pdf.get_y(), 100, pdf.get_y())
    pdf.cell(0, 10, 'Assinatura da Tesouraria', 0, 1)
    
    filename = f"recibo_{transaction.id}_{transaction.date.strftime('%Y%m%d')}.pdf"
    filepath = os.path.join(current_app.config['UPLOAD_FOLDER'], 'receipts', filename)
    
    # Ensure directory exists
    os.makedirs(os.path.dirname(filepath), exist_ok=True)
    
    pdf.output(filepath)
    return filename

\n\n===== ./app/__init__.py =====
from flask import Flask, render_template
from flask_login import LoginManager, current_user  # Import current_user aqui
from app.core.models import db, User, Event, Ministry  # Import Ministry para o context processor
from config import Config
from datetime import datetime

login_manager = LoginManager()

def create_app():
    app = Flask(__name__)
    app.config.from_object(Config)
    
    db.init_app(app)
    login_manager.init_app(app)
    login_manager.login_view = 'auth.login'
    
    @login_manager.user_loader
    def load_user(user_id):
        return User.query.get(int(user_id))
    
    # Context processor para eventos públicos na inicial
    @app.context_processor
    def inject_public_events():
        public_events = Event.query.filter(
            Event.ministry_id.is_(None),
            Event.start_time >= datetime.utcnow()
        ).order_by(Event.start_time.asc()).limit(5).all()
        return dict(public_events=public_events)
    
    # Context processor para verificar se o usuário é líder de algum ministério
    @app.context_processor
    def inject_is_ministry_leader():
        if current_user.is_authenticated:
            is_ministry_leader = Ministry.query.filter_by(leader_id=current_user.id).count() > 0
        else:
            is_ministry_leader = False
        return dict(is_ministry_leader=is_ministry_leader)
    
    # Register Blueprints
    from app.modules.auth.routes import auth_bp
    from app.modules.members.routes import members_bp
    from app.modules.finance.routes import finance_bp
    from app.modules.edification.routes import edification_bp
    from app.modules.admin.routes import admin_bp
    
    app.register_blueprint(auth_bp, url_prefix='/auth')
    app.register_blueprint(members_bp, url_prefix='/members')
    app.register_blueprint(finance_bp, url_prefix='/finance')
    app.register_blueprint(edification_bp, url_prefix='/edification')
    app.register_blueprint(admin_bp, url_prefix='/admin')
    
    # Main route
    @app.route('/')
    def index():
        return render_template('index.html')
        
    return app
\n\n===== ./config.py =====
import os
from datetime import timedelta

class Config:
    SECRET_KEY = os.environ.get('SECRET_KEY') or 'dev-key-ecclesia-2026'
    
    # Suporte dinâmico para PostgreSQL ou SQLite
    # No Heroku/Render, a variável DATABASE_URL é preenchida automaticamente
    database_url = os.environ.get('DATABASE_URL')
    if database_url and database_url.startswith("postgres://"):
        database_url = database_url.replace("postgres://", "postgresql://", 1)
    
    SQLALCHEMY_DATABASE_URI = database_url or 'sqlite:///ecclesia.db'
    SQLALCHEMY_TRACK_MODIFICATIONS = False
    
    REMEMBER_COOKIE_DURATION = timedelta(days=30)
    UPLOAD_FOLDER = os.path.join(os.path.abspath(os.path.dirname(__file__)), 'app/static/uploads')
    MAX_CONTENT_LENGTH = 16 * 1024 * 1024  # 16MB

\n\n===== ./run.py =====
from app import create_app

app = create_app()

if __name__ == '__main__':
    app.run(debug=True)

\n\n===== ./seed.py =====
from app import create_app
from app.core.models import db, User, Church, Devotional, Study, Transaction, Ministry, Family, ChurchRole, Asset
from datetime import datetime

app = create_app()

with app.app_context():
    # Limpa tudo (cuidado: só use em desenvolvimento!)
    db.drop_all()
    db.create_all()

    # 1. Criar Igrejas
    sede = Church(
        name="AD Jesus para as Nações - Sede",
        address="Rua Principal, 123",
        city="São Paulo",
        country="Brasil",
        is_main=True
    )
    filial1 = Church(
        name="AD Jesus para as Nações - Filial Norte",
        address="Av. Norte, 456",
        city="São Paulo",
        country="Brasil"
    )
    db.session.add_all([sede, filial1])
    db.session.commit()

    # 2. Criar cargos para cada igreja
    cargo_admin = ChurchRole(name="Administrador Global", description="Acesso total ao sistema", church_id=sede.id, order=1)
    cargo_pastor_lider = ChurchRole(name="Pastor Líder", description="Liderança da congregação", church_id=sede.id, order=2)
    cargo_tesoureiro = ChurchRole(name="Tesoureiro", description="Gestão financeira da filial", church_id=sede.id, order=3)
    cargo_membro = ChurchRole(name="Membro", description="Membro comum", church_id=sede.id, order=10)

    db.session.add_all([cargo_admin, cargo_pastor_lider, cargo_tesoureiro, cargo_membro])
    db.session.commit()

    # 3. Criar Usuários com permissões explícitas
    admin = User(
        name="Super Admin",
        email="admin@igreja.com",
        birth_date=datetime(1980, 1, 1).date(),
        church_id=sede.id,
        church_role_id=cargo_admin.id,
        status="active",
        can_manage_finance=True,
        can_manage_media=True,
        can_publish_devotionals=True,
        can_approve_members=True,
        can_manage_kids=True
    )
    admin.set_password("admin123")

    pastor_sede = User(
        name="Pr. Roberto",
        email="pastor@igreja.com",
        birth_date=datetime(1975, 6, 15).date(),
        church_id=sede.id,
        church_role_id=cargo_pastor_lider.id,
        status="active",
        can_approve_members=True,
        can_publish_devotionals=True,
        can_manage_kids=True
    )
    pastor_sede.set_password("pastor123")

    tesoureiro = User(
        name="Irmã Financeira",
        email="tesouro@igreja.com",
        birth_date=datetime(1985, 3, 20).date(),
        church_id=sede.id,
        church_role_id=cargo_tesoureiro.id,
        status="active",
        can_manage_finance=True
    )
    tesoureiro.set_password("tesouro123")

    membro_sede = User(
        name="Membro Ativo",
        email="membro@igreja.com",
        birth_date=datetime(1995, 5, 15).date(),
        church_id=sede.id,
        church_role_id=cargo_membro.id,
        status="active"
    )
    membro_sede.set_password("membro123")

    db.session.add_all([admin, pastor_sede, tesoureiro, membro_sede])
    db.session.commit()

    # 4. Ministérios
    louvor = Ministry(name="Ministério de Louvor", description="Equipe de música e adoração", church_id=sede.id, leader_id=membro_sede.id)
    kids = Ministry(name="Ministério Infantil", description="Educação cristã para crianças", church_id=sede.id, leader_id=pastor_sede.id)
    db.session.add_all([louvor, kids])
    db.session.commit()

    # 5. Conteúdo
    estudo = Study(title="A Importância da Oração", content="A oração é o fôlego da alma...", category="Espiritualidade", author_id=pastor_sede.id)
    dev = Devotional(title="Firmeza na Rocha", content="O Senhor é o meu pastor...", verse="Salmos 23:1")
    db.session.add_all([estudo, dev])
    
    # 6. Financeiro
    tx1 = Transaction(type='income', category='Dízimo', amount=500.0, description='Dízimo Mensal', user_id=membro_sede.id, church_id=sede.id)
    tx2 = Transaction(type='expense', category='Energia', amount=150.0, description='Conta de Luz', church_id=sede.id)
    db.session.add_all([tx1, tx2])

    # 7. Patrimônio
    som = Asset(name="Mesa de Som", category="Equipamento", identifier="SN-12345", value=2500.0, church_id=sede.id)
    db.session.add(som)

    db.session.commit()
    print("Seed concluído com sucesso!")
    print("Usuários criados (email / senha):")
    print("- admin@igreja.com / admin123")
    print("- pastor@igreja.com / pastor123")
    print("- tesouro@igreja.com / tesouro123")
    print("- membro@igreja.com / membro123")

\n\n===== ./README.md =====
# ecclesia_master

\n\n===== ./seed_devotionals.py =====
from datetime import datetime, timedelta
from app import create_app
from app.core.models import db, Devotional

app = create_app()

def seed_devotionals():
    with app.app_context():
        start_date = datetime(2026, 1, 1).date()
        end_date = datetime(2026, 12, 31).date()
        current_date = start_date
        
        # Exemplos reais em português (inspirados em Pão Diário, Palavra Viva, etc.)
        # Você pode adicionar mais ou substituir por conteúdo real depois
        examples = [
            {"title": "A Paz de Deus", "verse": "Filipenses 4:7", "content": "A paz de Deus, que excede todo entendimento, guardará os vossos corações e os vossos pensamentos em Cristo Jesus."},
            {"title": "Confiança no Senhor", "verse": "Provérbios 3:5-6", "content": "Confia no Senhor de todo o teu coração e não te estribes no teu próprio entendimento."},
            {"title": "O Amor de Deus", "verse": "João 3:16", "content": "Porque Deus amou o mundo de tal maneira que deu o seu Filho unigênito..."},
            {"title": "Força na Fraqueza", "verse": "2 Coríntios 12:9", "content": "A minha graça te basta, porque o meu poder se aperfeiçoa na fraqueza."},
            {"title": "Caminho de Vida", "verse": "Salmos 16:11", "content": "Tu me mostrarás a vereda da vida; na tua presença há plenitude de alegria."},
            # Adicione mais se quiser (ou deixe ciclar)
        ]
        
        count = 0
        while current_date <= end_date:
            existing = Devotional.query.filter_by(date=current_date).first()
            if not existing:
                example = examples[count % len(examples)]  # Cicla pelos exemplos
                new_dev = Devotional(
                    title=example["title"],
                    content=example["content"],
                    verse=example["verse"],
                    date=current_date,
                    church_id=1  # Ajuste para o ID da sede ou deixe None se for geral
                )
                db.session.add(new_dev)
                count += 1
            current_date += timedelta(days=1)
        
        db.session.commit()
        print(f"{count} devocionais adicionados com sucesso (2026)!")

if __name__ == '__main__':
    seed_devotionals()
\n\n===== ./fix_devotional_dates.py =====
from datetime import datetime, timedelta
from app import create_app
from app.core.models import db, Devotional

app = create_app()

def fix_devotional_dates():
    with app.app_context():
        # Pegue todos os devocionais
        devotionals = Devotional.query.all()
        if not devotionals:
            print("Nenhum devocional encontrado.")
            return
        
        # Comece a partir de hoje (ou uma data recente)
        start_date = datetime(2026, 2, 9).date()  # Data de hoje no seu teste
        count = 0
        
        for dev in devotionals:
            new_date = start_date + timedelta(days=count)
            dev.date = new_date
            count += 1
        
        db.session.commit()
        print(f"{len(devotionals)} datas corrigidas! O mais recente agora é {devotionals[-1].date}")

if __name__ == '__main__':
    fix_devotional_dates()
\n\n===== ./fix_devotional_dates_safe.py =====
from datetime import datetime, timedelta
from app import create_app
from app.core.models import db, Devotional

app = create_app()

def fix_devotional_dates_safe():
    with app.app_context():
        # Pegar todos os devocionais ordenados pela data atual
        devotionals = Devotional.query.order_by(Devotional.date).all()
        if not devotionals:
            print("Nenhum devocional encontrado.")
            return
        
        # Data inicial desejada (hoje ou uma data recente)
        base_date = datetime(2026, 2, 9).date()  # Ajuste se quiser outra data inicial
        
        updated = 0
        for dev in devotionals:
            new_date = base_date
            # Encontra a próxima data livre
            while Devotional.query.filter_by(date=new_date).first():
                new_date += timedelta(days=1)
            
            if dev.date != new_date:
                dev.date = new_date
                updated += 1
        
        db.session.commit()
        print(f"{updated} datas corrigidas com sucesso!")
        if devotionals:
            latest = Devotional.query.order_by(Devotional.date.desc()).first()
            print(f"Data do mais recente agora: {latest.date}")
            print(f"Data de hoje: {datetime.utcnow().date()}")

if __name__ == '__main__':
    fix_devotional_dates_safe()
